æˆ‘æœ‰ä¸€å€‹ç°¡å–®çš„vb .netå°ˆæ¡ˆï¼Œæˆ‘æƒ³è¦ä½¿ç”¨ChatGPTç‚ºæˆ‘åˆ†æå°ˆæ¡ˆæ¶æ§‹èˆ‡ç¨‹å¼é‚è¼¯ï¼Œè®“å®ƒå”åŠ©æˆ‘åœ¨åŸæœ¬çš„å°ˆæ¡ˆæ¶æ§‹ä¸‹æ–°å¢æ–°çš„åŠŸèƒ½ï¼Œä¾‹å¦‚ç•¶æˆ‘è¦æ–°å¢åŠŸèƒ½çš„æ™‚å€™ï¼Œæˆ‘æ‡‰è©²ä½¿ç”¨é‚£äº›ä½¿ç”¨è€…ç™»å…¥ç›¸é—œçš„åŠŸèƒ½æˆ–æ¨¡çµ„ä¾†ç®¡ç†ä½¿ç”¨è€…ç™»å…¥ç‹€æ…‹Sessionï¼Œé‚„æœ‰ï¼Œé€™å€‹ç³»çµ±æ˜¯ç‚ºäº†å¢å¼·sap b1åŠŸèƒ½æ‰€å»ºç½®ï¼Œå®ƒæœƒæŠ“å–sap b1 çš„è³‡æ–™åº«è³‡æ–™ï¼Œåœ¨å¹³å°ä¸Šé€²ä¸€æ­¥è™•ç†ä¹‹å¾Œå¯«å›ï¼Œæ‰€ä»¥æˆ‘ä¹Ÿè¦çŸ¥é“ï¼Œç•¶æˆ‘è¦æŠ“å–ç³»çµ±è³‡æ–™ï¼Œæˆ‘æ‡‰è©²ç”¨é‚£äº›æ–¹æ³•å’Œæ¨¡æ¿ä¾†é¡¯ç¤ºçµ¦ä½¿ç”¨è€…ï¼Œæœ€å¾Œï¼Œç•¶æˆ‘è¦å¯«å…¥è³‡æ–™åˆ°ç³»çµ±ï¼Œæˆ‘åˆè©²ä½¿ç”¨å“ªäº›æ–¹æ³•ï¼Œæˆ‘å¸Œæœ›ä½¿ç”¨ChatGPTå”åŠ©æˆ‘å…ˆå¾¹åº•åˆ†ææ•´å€‹å°ˆæ¡ˆçš„æ¶æ§‹ï¼Œå†ä¸€æ­¥æ­¥å»ºç½®æˆ‘è¦çš„æ–°åŠŸèƒ½æˆ–å„ªåŒ–å°ˆæ¡ˆï¼Œå…å¾—æˆ‘åœ¨å°åŸæ¶æ§‹ä¸€çŸ¥åŠè§£çš„æƒ…æ³ä¸‹åŠ æ±åŠ è¥¿ï¼ŒæŠŠç³»çµ±è®Šæˆé†œä¸æ‹‰æ©Ÿçš„ç¸«åˆæ€ªï¼Œæ›´æ…˜çš„æ˜¯åŠ å…¥äº†è‡­èŸ²å’Œæ¼æ´ã€‚
ChatGPT èªªï¼š
å·²æ€è€ƒ 1m 32s

å¤ªå¥½äº†ï¼é€™ä»¶äº‹å¯ä»¥åšå¾—å¾ˆæœ‰ç³»çµ±ï¼Œè€Œä¸”ä¸ç”¨æŠŠå°ˆæ¡ˆæ”¹åˆ°é¢ç›®å…¨éã€‚ä¸‹é¢çµ¦ä½ ä¸€ä»½ã€Œæœ€å°æˆæœ¬ã€æœ€é«˜å¯ç¶­è­·åº¦ã€çš„å¯¦æˆ°è—åœ–ï¼šå…ˆæŠŠç¾æœ‰ VB.NET å°ˆæ¡ˆå®Œæ•´ç›¤é»ï¼Œå†å®šç¾©ä¸€çµ„å›ºå®šçš„æ“´å……â€œæ¥ç¸«â€ï¼ˆextension seamsï¼‰ï¼Œä¹‹å¾Œæ–°å¢åŠŸèƒ½å°±åªè¦æ²¿è‘—é€™äº›æ¥ç¸«èµ°ï¼Œé¢¨æ ¼ä¸€è‡´ã€é¢¨éšªæœ€ä½ã€‚

ä¸€ã€è«‹å…ˆæŠŠé€™äº›è¼¸å‡ºçµ¦æˆ‘ï¼ˆä¸€æ¬¡åˆ°ä½æ¸…å–®ï¼‰

æŠŠä½ å°ˆæ¡ˆæ ¹ç›®éŒ„åŸ·è¡Œä»¥ä¸‹ä»»ä¸€æŒ‡ä»¤ï¼Œç”¢ç”Ÿæª”æ¡ˆæ¨¹èˆ‡é—œéµè¨­å®šï¼Œè²¼ä¸Šæˆ–ä¸Šå‚³å³å¯ã€‚æˆ‘æœƒç”¨é€™äº›åšæ¶æ§‹èˆ‡é‚è¼¯ç¸½é«”è§£æã€‚

Windows CMDï¼ˆæœ€ç°¡å–®ï¼‰

tree /F > _project_tree.txt


PowerShellï¼ˆå«é—œéµè¨­å®šï¼‰

Get-ChildItem -Recurse | Select-Object FullName | Out-File _project_tree.txt
Get-Content .\*.sln, .\**\*.vbproj, .\**\Web.config, .\**\App.config -ErrorAction SilentlyContinue | Out-File _project_configs_snippet.txt


åŒæ™‚é™„ä¸Šï¼ˆè‹¥æœ‰ï¼‰ï¼š

ä½¿ç”¨è€…ç™»å…¥/é©—è­‰ç›¸é—œæª”ï¼šLogin.aspx(.vb)ã€Global.asax(.vb)ã€BasePage.vbã€Auth*ã€Session*ã€Membership*

è³‡æ–™å­˜å–å±¤ï¼šRepositoryã€DALã€SqlHelperã€Sbo*ï¼ˆDI API åŒ…è£ï¼‰

å•†æ¥­é‚è¼¯å±¤ï¼šService æˆ– Manager é¡åˆ¥

UI ä¸»è¦é é¢èˆ‡å…±ç”¨æ§åˆ¶ï¼ˆWinForms çš„ MainForm.vb / Web çš„ MasterPage.masterã€UserControlï¼‰

æ‹¿åˆ°é€™äº›å¾Œï¼Œæˆ‘æœƒå›ä½ ä¸€ä»½æ¸…æ™°çš„ã€Œç¾æ³æ¶æ§‹åœ°åœ– + æ¨¡çµ„é—œè¯åœ– + è³‡æ–™æµ/å‘¼å«æµã€ï¼Œå†æ“šæ­¤è¨­è¨ˆä½ çš„åŠŸèƒ½æ“´å……æ¥ç¸«ã€‚

äºŒã€åƒè€ƒæ¶æ§‹è—åœ–ï¼ˆä¸é‡æ§‹ä¹Ÿèƒ½è½åœ°ï¼‰

ç„¡è«–ä½ æ˜¯ WinForms æˆ– ASP.NET WebFormsï¼Œéƒ½å»ºè­°æ¡ 3.5 å±¤å¼ï¼ˆUI / Application(Service) / Domain(Models) / Infrastructure(DAL+DI API)ï¼‰ï¼š

/App
  /UI                  ' WinForms æˆ– WebForms
  /Application         ' ç”¨ä¾‹æœå‹™ï¼ˆUse Casesï¼‰ï¼šæˆæ¬Šã€æµç¨‹ã€é©—è­‰
  /Domain              ' DTO/Models + è¦å‰‡ï¼ˆè¼•é‡ï¼‰
  /Infrastructure
      /DataAccess      ' MSSQL è®€å–ï¼ˆSqlClientï¼Œå”¯è®€ï¼‰
      /SboDiApi        ' SAP B1 DI API å¯«å…¥ï¼ˆäº¤æ˜“ä¸€è‡´æ€§ï¼‰
  /CrossCutting        ' è¨­å®šã€è¨˜éŒ„ã€Error handlingã€Mapping


åŸå‰‡

è®€ï¼ˆReadï¼‰ï¼šå° SAP B1 è³‡æ–™åº«ï¼ˆå…¬å¸åº« + SBO-COMMONï¼‰ç”¨ å”¯è®€ SQLï¼ˆSystem.Data.SqlClientï¼Œå…¨éƒ¨åƒæ•¸åŒ–ï¼‰ã€‚

å¯«ï¼ˆWriteï¼‰ï¼šä¸€å¾‹èµ° DI APIï¼ˆDocumentsã€BusinessPartnersã€JournalEntriesâ€¦ï¼‰ï¼Œç¢ºä¿éå¸³è¦å‰‡ã€å…§å»ºé©—è­‰ã€äº‹ä»¶æ­£ç¢ºè§¸ç™¼ã€‚

äº¤æ˜“ï¼šDI API çš„ StartTransaction/EndTransaction åŒ…ä½ä¸€çµ„æ¥­å‹™æ“ä½œï¼›åš´ç¦è·¨è¶Šå¤šå€‹ UI æŒ‰éˆ•æˆ–å¤šå€‹ HTTP è«‹æ±‚ã€‚

ä¸‰ã€ç™»å…¥ / Session ç®¡ç†ï¼ˆé¸ä½ çš„å‹æ…‹ï¼‰
3-1 WinFormsï¼ˆå¤šç‚ºå…§ç¶²å·¥å…·ï¼‰

å»ºä¸€å€‹å…¨åŸŸä½¿ç”¨è€…å…§å®¹ï¼ˆä¸é  ASP.NET Sessionï¼‰ï¼š

' /CrossCutting/Security/UserContext.vb
Option Strict On
Option Explicit On

Public Module UserContext
    Public Property UserId As String
    Public Property UserName As String
    Public Property Roles As String() = {}
    Public ReadOnly Property IsAuthenticated As Boolean
        Get
            Return Not String.IsNullOrEmpty(UserId)
        End Get
    End Property
End Module


UI é€²å…¥é»ï¼ˆä¾‹å¦‚ MainForm_Loadï¼‰æª¢æŸ¥ UserContext.IsAuthenticatedï¼Œå¦å‰‡å½ˆç™»å…¥çª—é«”ã€‚

æ¬Šé™æ§åˆ¶ï¼šåœ¨ Application å±¤æä¾› Authorize(role) æ–¹æ³•ï¼ŒUI åœ¨å‹•ä½œå‰å‘¼å«ã€‚

3-2 ASP.NET WebFormsï¼ˆè€å°ˆæ¡ˆå¸¸è¦‹ï¼‰

FormsAuthentication + Sessionï¼Œæ­é… BasePage åšé›†ä¸­å®ˆé–€ï¼š

' /UI/Web/BasePage.vb
Option Strict On : Option Explicit On
Imports System.Web.Security

Public Class BasePage
    Inherits System.Web.UI.Page

    Protected Overrides Sub OnInit(e As EventArgs)
        MyBase.OnInit(e)
        If (Context.User Is Nothing OrElse Not Context.User.Identity.IsAuthenticated) Then
            Response.Redirect("~/Login.aspx?returnUrl=" & Server.UrlEncode(Request.RawUrl))
        End If
    End Sub
End Class


ç™»å…¥æˆåŠŸå¾Œç°½ç™¼ç¥¨è­‰ + è¼‰å…¥è§’è‰²ï¼š

' /UI/Web/Login.aspx.vbï¼ˆæˆåŠŸé©—è­‰å¸³å¯†ä¹‹å¾Œï¼‰
Dim ticket = New FormsAuthenticationTicket(1, userId, DateTime.Now, DateTime.Now.AddMinutes(60), False, String.Join(",", roles))
Dim enc = FormsAuthentication.Encrypt(ticket)
Dim cookie = New HttpCookie(FormsAuthentication.FormsCookieName, enc) With {.HttpOnly = True}
Response.Cookies.Add(cookie)
Response.Redirect(FormsAuthentication.GetRedirectUrl(userId, False))


è¦é»ï¼š

å•Ÿç”¨ Sliding Expirationã€Cookie HttpOnlyï¼ˆè‹¥æœ‰ HTTPS å†åŠ  Secureï¼‰ã€‚

Session è£¡åªæ”¾å¿…è¦è­˜åˆ¥ï¼ˆUserIdã€é¡¯ç¤ºåã€è§’è‰²ï¼‰ï¼›è³‡æ–™ä¸è¦æ”¾ Sessionã€‚

å¯æŠ½ä¸€å€‹ AuthService çµ¦ UI å‘¼å«ï¼ŒåŒæ™‚ç”¢å‡ºå¯©è¨ˆ Logã€‚

å››ã€è®€è³‡æ–™ï¼ˆMSSQL 2005ï¼Œå„ªå…ˆ CTEï¼‰

é€£ç·šå­—ä¸²æ”¾ App.config/Web.configã€‚Data Access ä¸€å¾‹èµ° Using + åƒæ•¸åŒ–ï¼š

' /Infrastructure/DataAccess/SqlHelper.vb
Option Strict On : Option Explicit On
Imports System.Data.SqlClient
Imports System.Configuration

Public NotInheritable Class SqlHelper
    Private Sub New()
    End Sub

    Public Shared Function Query(Of T)(sql As String, binder As Func(Of SqlDataReader, T), ParamArray parameters As SqlParameter()) As List(Of T)
        Dim list As New List(Of T)
        Dim cs = ConfigurationManager.ConnectionStrings("SboCompanyDb").ConnectionString
        Using cn As New SqlConnection(cs), cmd As New SqlCommand(sql, cn)
            cmd.Parameters.AddRange(parameters)
            cn.Open()
            Using rd = cmd.ExecuteReader()
                While rd.Read()
                    list.Add(binder(rd))
                End While
            End Using
        End Using
        Return list
    End Function
End Class


æŸ¥è©¢æ¨£ç‰ˆï¼ˆCTEï¼›ä»¥éŠ·å”®è¨‚å–®ç‚ºä¾‹ï¼Œè®€æ¬„/åˆ—ï¼‰ï¼š

;WITH R AS (
    SELECT 
        T0.DocEntry,
        T0.DocNum,
        T0.CardCode,
        T0.CardName,
        T0.DocDate,
        T1.LineNum,
        T1.ItemCode,
        T1.Dscription,
        T1.Quantity,
        T1.Price,
        (T1.Quantity * T1.Price) AS LineTotal
    FROM ORDR T0
    INNER JOIN RDR1 T1 ON T0.DocEntry = T1.DocEntry
    WHERE T0.DocDate BETWEEN @From AND @To
      AND (@CardCode = '' OR T0.CardCode = @CardCode)
)
SELECT * FROM R
ORDER BY DocDate DESC, DocEntry, LineNum;


2005 OKã€å¯æ“´å……åˆ†é ã€æ¢ä»¶çµ„åˆï¼›æ‰€æœ‰æ¢ä»¶çš†ç”¨åƒæ•¸ã€‚

äº”ã€é¡¯ç¤ºæ¨¡æ¿ï¼ˆä½¿ç”¨è€…ç«¯å‹å–„ï¼‰

WinForms

BindingSource + DataGridViewï¼ˆæ¬„ = Columnsã€åˆ— = Rowsï¼‰ï¼Œé—œéµæ˜¯åªç¶å®š DTOï¼ŒUI ä¸è¦ç›´æ¥ç¶ DataTable ä»¥å…è€¦åˆã€‚

' /UI/WinForms/OrdersForm.vb ç‰‡æ®µ
Dim data = orderService.GetOrders(dtoFilter) ' å› DTO List(Of OrderRow)
Dim bs As New BindingSource() With {.DataSource = data}
DataGridView1.AutoGenerateColumns = False
DataGridView1.DataSource = bs


WebForms

GridView/Repeater + ä¼ºæœç«¯åˆ†é ï¼ˆé¿å…ä¸€æ¬¡è¼‰å¤ªå¤šåˆ—ï¼‰ï¼Œæ—¥æœŸ/é‡‘é¡çµ±ä¸€ DataFormatStringï¼›æŸ¥è©¢æ¢ä»¶æ”¾åœ¨ä¸Šæ–¹çš„ã€Œæ¢ä»¶å€ã€ã€‚

å…­ã€å›å¯«è³‡æ–™åˆ° SAPï¼ˆDI APIï¼Œäº¤æ˜“ä¸€è‡´æ€§ï¼‰

é€£ç·šèˆ‡äº¤æ˜“æ¨£æ¿

' /Infrastructure/SboDiApi/SboConnection.vb
Option Strict On : Option Explicit On
Imports SAPbobsCOM

Public Class SboConnection
    Public Shared Function Connect(companyDb As String, server As String, licenseServer As String, user As String, pwd As String) As Company
        Dim c As New Company With {
            .Server = server,
            .CompanyDB = companyDb,
            .DbServerType = BoDataServerTypes.dst_MSSQL2005,
            .UserName = user,
            .Password = pwd,
            .language = BoSuppLangs.ln_English,
            .LicenseServer = licenseServer
        }
        Dim ret = c.Connect()
        If ret <> 0 Then
            Dim err, msg As String
            c.GetLastError(err, msg)
            Throw New ApplicationException($"DI API Connect failed: {err} - {msg}")
        End If
        Return c
    End Function
End Class


å¯«å…¥ï¼ˆä»¥æ–°å¢ç™¼ç¥¨ç‚ºä¾‹ï¼›æ³¨æ„ï¼šç¯„ä¾‹åƒ…ç¤ºæ„ï¼‰

' /Application/ArInvoiceService.vb
Option Strict On : Option Explicit On
Imports SAPbobsCOM

Public Class ArInvoiceService
    Private ReadOnly _company As Company
    Public Sub New(company As Company)
        _company = company
    End Sub

    Public Sub CreateInvoice(dto As ArInvoiceDto)
        If Not _company.InTransaction Then _company.StartTransaction()
        Try
            Dim oInv = CType(_company.GetBusinessObject(BoObjectTypes.oInvoices), Documents)
            oInv.CardCode = dto.CardCode
            oInv.DocDate = dto.DocDate

            For Each l In dto.Lines
                oInv.Lines.ItemCode = l.ItemCode
                oInv.Lines.Quantity = l.Qty
                oInv.Lines.Price = l.Price
                oInv.Lines.Add()
            Next

            Dim ret = oInv.Add()
            If ret <> 0 Then
                Dim err, msg As String
                _company.GetLastError(err, msg)
                Throw New ApplicationException($"Add Invoice failed: {err} - {msg}")
            End If

            _company.EndTransaction(BoWfTransOpt.wf_Commit)
        Catch
            If _company.InTransaction Then _company.EndTransaction(BoWfTransOpt.wf_RollBack)
            Throw
        End Try
    End Sub
End Class


é—œéµè¦ç¯„ï¼š

è®€ç”¨ SQLã€å¯«ç”¨ DI APIï¼›

ä¸€å€‹ç”¨ä¾‹ = ä¸€å€‹ DI äº¤æ˜“ï¼ˆStart â†’ Commit/Rollbackï¼‰ï¼›

å¤±æ•—è¦ bubble upï¼ŒUI çµ±ä¸€é¡¯ç¤ºå‹å–„éŒ¯èª¤ä¸¦å¯«å…¥ Logï¼ˆå« DI error codeï¼‰ï¼›

æ‰€æœ‰é‡‘é¡/ç¨…ç‡èˆ‡ç§‘ç›®ä»¥ SAP ä¸»æª”/è¨­å®šç‚ºæº–ï¼Œä¸è¦ç¡¬ç·¨ã€‚

ä¸ƒã€åŠ æ–°åŠŸèƒ½çš„ã€Œå›ºå®šæµç¨‹ã€ï¼ˆPlaybookï¼‰

æ¯æ¬¡æ“´å……éƒ½ç…§é€™ 8 æ­¥èµ°ï¼Œç³»çµ±å°±ä¸æœƒè®Šç¸«åˆæ€ªï¼š

å®šç¾©ç”¨ä¾‹ï¼ˆè¼¸å…¥éæ¿¾æ¢ä»¶ã€UI æ¬„ä½ã€æ¬Šé™éœ€æ±‚ã€ä¾‹å¤–ç‹€æ³ï¼‰

æ–°å¢ DTOï¼ˆDomain å±¤ï¼‰

Repository æ–¹æ³•ï¼ˆInfrastructure/DataAccessï¼Œåªè®€ SQLï¼›å„ªå…ˆ CTEï¼‰

Service æ–¹æ³•ï¼ˆApplication å±¤ï¼šæˆæ¬Šã€é©—è­‰ã€æµç¨‹ï¼‰

ï¼ˆè‹¥å¯«å…¥ï¼‰Sbo Serviceï¼ˆDI API äº¤æ˜“ + éŒ¯èª¤è™•ç†ï¼‰

UI ç¶å®šï¼ˆæ¬„å¯¬ã€æ ¼å¼ã€åˆ†é ã€è¼¸å…¥é©—è­‰ï¼‰

è¨˜éŒ„èˆ‡å¯©è¨ˆï¼ˆLogï¼šèª°åœ¨ä»€éº¼æ™‚é–“å°ä»€éº¼å–®æ“šåšäº†ä»€éº¼ï¼‰

å›æ­¸æ¸¬è©¦è…³æœ¬ï¼ˆæœ€å°‘æ¶µè“‹æˆåŠŸ/å¤±æ•—/é‚Šç•Œï¼‰

Repository ç¯„ä¾‹ï¼ˆè®€ï¼‰

' /Infrastructure/DataAccess/OrderRepository.vb
Option Strict On : Option Explicit On
Imports System.Data.SqlClient

Public Class OrderRepository
    Public Function GetOrders(fromDate As Date, toDate As Date, Optional cardCode As String = "") As List(Of OrderRow)
        Const sql = "
;WITH R AS (
  SELECT T0.DocEntry, T0.DocNum, T0.CardCode, T0.CardName, T0.DocDate,
         T1.LineNum, T1.ItemCode, T1.Dscription, T1.Quantity, T1.Price,
         (T1.Quantity*T1.Price) AS LineTotal
  FROM ORDR T0
  JOIN RDR1 T1 ON T0.DocEntry=T1.DocEntry
  WHERE T0.DocDate BETWEEN @From AND @To
    AND (@CardCode='' OR T0.CardCode=@CardCode)
)
SELECT * FROM R ORDER BY DocDate DESC, DocEntry, LineNum;"
        Return SqlHelper.Query(sql,
            Function(r) New OrderRow With {
                .DocEntry = r.GetInt32(0),
                .DocNum = r.GetInt32(1),
                .CardCode = r.GetString(2),
                .CardName = r.GetString(3),
                .DocDate = r.GetDateTime(4),
                .LineNum = r.GetInt32(5),
                .ItemCode = r.GetString(6),
                .Dscription = r.GetString(7),
                .Quantity = r.GetDecimal(8),
                .Price = r.GetDecimal(9),
                .LineTotal = r.GetDecimal(10)
            },
            New SqlParameter("@From", fromDate),
            New SqlParameter("@To", toDate),
            New SqlParameter("@CardCode", If(cardCode, String.Empty)))
    End Function
End Class

å…«ã€ç©©å®šèˆ‡å®‰å…¨æ¸…å–®ï¼ˆå‹™å¿…è½åœ°ï¼‰

é€£ç·šæœ€å°æ¬Šé™ï¼šè®€è³‡æ–™ç”¨å”¯è®€å¸³è™Ÿï¼›DI API ç”¨å…·åã€å¯å¯©è¨ˆçš„ SAP å¸³è™Ÿã€‚

åƒæ•¸åŒ– SQLï¼ˆç¦æ­¢å­—ä¸²æ‹¼æ¥ï¼‰ï¼›CommandTimeout åˆç†è¨­å®šã€‚

çµ±ä¸€éŒ¯èª¤è™•ç†ï¼šInfrastructure æ‹‹å‡ºå…·é«”ã€Application ç¿»è­¯æˆæ¥­å‹™èªæ„ã€UI å‹å–„é¡¯ç¤ºã€‚

è¨˜éŒ„ï¼ˆLogï¼‰ï¼šå‹•ä½œã€ä½¿ç”¨è€…ã€ä¾†æºæ©Ÿã€DI error codeã€å½±éŸ¿ DocEntryã€‚

è¨­å®šç®¡ç†ï¼šApp.config/Web.config + åŠ å¯†æ•æ„Ÿå­—ä¸²ï¼ˆaspnet_regiis -pef é©ç”¨ Webï¼‰ã€‚

æ¬„/åˆ—è¦ç¯„ï¼šUI æ‰€è¦‹æ¬„ï¼ˆColumnsï¼‰èˆ‡åˆ—ï¼ˆRowsï¼‰å‘½åä¸€è‡´ï¼Œé¿å…æ··äº‚ã€‚

æ•ˆèƒ½ï¼šæŸ¥è©¢åˆ†é ï¼›é¿å…ä¸€æ¬¡è¼‰æ•¸è¬åˆ—ï¼›å¿…è¦æ™‚å…ˆæŸ¥ã€Œå½™ç¸½ã€å† Drill-downã€‚

ç›¸å®¹æ€§ï¼šSQL 2005ï¼šä½¿ç”¨ CTEã€é¿å… MERGEã€é¿å…æ–°èªæ³•ã€‚

ä¹ã€ä¸‹ä¸€æ­¥ï¼ˆä½ å¯ä»¥ç›´æ¥é€™æ¨£åšï¼‰

ä¾ã€Œä¸€æ¬¡åˆ°ä½æ¸…å–®ã€è¼¸å‡º _project_tree.txt èˆ‡ _project_configs_snippet.txtï¼Œå¤–åŠ ç™»å…¥/è³‡æ–™å­˜å–/DI API ç›¸é—œæª”æ¡ˆã€‚

å‘Šè¨´æˆ‘ä½ æƒ³å…ˆåšçš„ç¬¬ä¸€å€‹æ–°åŠŸèƒ½ï¼ˆä¸€å¥è©±æè¿°å³å¯ï¼Œä¾‹å¦‚ã€Œå¢åŠ ä¸€å€‹é é¢ï¼šä¾æœŸé–“ã€å®¢æˆ¶ç­‰æ¢ä»¶æŸ¥è©¢éŠ·å”®è¨‚å–®ï¼Œé»åˆ—å¯ç›´æ¥ç”¢ç”Ÿé€è²¨å–®ã€ï¼‰ã€‚

æˆ‘æœƒå›ä½ ï¼š

å°ˆæ¡ˆç¾æ³æ¶æ§‹åœ–ï¼ˆæ¨¡çµ„ã€ä¾è³´ã€è³‡æ–™æµï¼‰ï¼›

æ“´å……æ¥ç¸«è¨­è¨ˆï¼ˆè¦æ–°å¢å“ªäº›æª”ã€æ”¾å“ªå€‹è³‡æ–™å¤¾ã€å‘½åèˆ‡ç¯„æœ¬ï¼‰ï¼›

é¦–å€‹åŠŸèƒ½çš„ç«¯åˆ°ç«¯è…³æ‰‹æ¶ï¼ˆSQL CTE æŸ¥è©¢ + Service + UI ç¶å®š + DI API å¯«å…¥é››å‹ï¼‰ã€‚

å¦‚æ­¤ä¸€ä¾†ï¼Œä½ å¯ä»¥åœ¨ä¸ç ´å£åŸæ¶æ§‹çš„å‰æä¸‹ï¼Œé€æ­¥æŠŠåŠŸèƒ½å †ç–Šèµ·ä¾†ï¼Œè€Œä¸”æ¯æ¬¡æ“´å……éƒ½èµ°åŒä¸€å¥—æµç¨‹ï¼Œé•·æœŸå¯ç¶­è­·ã€‚

éœ€è¦æˆ‘å…ˆç”¢ä¸€ä»½æ¨™æº–ç›®éŒ„éª¨æ¶ + ç¯„æœ¬æª”çµ¦ä½ ç›´æ¥æ”¾é€²å°ˆæ¡ˆå—ï¼Ÿï¼ˆå« SqlHelperã€OrderRepositoryã€ArInvoiceServiceã€BasePage/UserContext ç¯„æœ¬èˆ‡å…±ç”¨éŒ¯èª¤è™•ç†æ¨¡çµ„ï¼‰ã€‚ä½ ä¸€è²¼æˆ‘å°±èƒ½å°ä½ çš„å¯¦éš›å°ˆæ¡ˆåšæº–ç¢ºæ¯”å°ä¸¦çµ¦å‡ºç²¾æº–èª¿æ•´æŒ‡å¼•ã€‚

ï¼ˆ2025å¹´09æœˆ19æ—¥15æ™‚54åˆ†ï¼Œå°åŒ—ï¼‰

ä½ èªªï¼š
_project_tree.txt
æ–‡ä»¶
Web.config
æª”æ¡ˆ
Index.aspx.vb
æª”æ¡ˆ
Index.aspx
æª”æ¡ˆ
Global.asax
æª”æ¡ˆ
Global.asax.vb
æª”æ¡ˆ
CommSignOff.vb
æª”æ¡ˆ
CommUtil.vb
æª”æ¡ˆ
ShowData.aspx
æª”æ¡ˆ
ShowData.aspx.vb
æª”æ¡ˆ
OKï¼Œè«‹å…ˆç‚ºæˆ‘åˆ†æå°ˆæ¡ˆçš„é‡è¦æª”æ¡ˆï¼Œç„¶å¾Œæˆ‘å¸Œæœ›ä½ ç›´æ¥å¾æ–°å¢ç¬¬ä¸€å€‹åŠŸèƒ½ä¸€æ­¥æ­¥æ•™æˆ‘ï¼Œåˆ†æä¸­å¦‚æœè¦ºå¾—é‚„éœ€è¦æˆ‘è£œå……ä»€éº¼æª”æ¡ˆè«‹å‘Šè¨´æˆ‘ä¸¦å”åŠ©æˆ‘å–å¾—å®ƒ(ä¾‹å¦‚è³‡æ–™åº«Tableçš„æ¶æ§‹)ï¼Œç­‰æˆ‘è£œä¸Šä½ éœ€è¦çš„æ‰€æœ‰æª”æ¡ˆèˆ‡è³‡è¨Šä¹‹å¾Œå†é–‹å§‹ï¼Œä¸è¦åœ¨è³‡è¨Šä¸å…¨çš„æƒ…æ³ä¸‹æ€¥è‘—é–‹å§‹ï¼Œè¬è¬ã€‚
ChatGPT èªªï¼š
å·²æ€è€ƒ 4m 20s

å¤ªå¥½äº†ï¼Œæˆ‘å…ˆç”¨ä½ æä¾›çš„æª”æ¡ˆåšäº†ä¸€è¼ªã€Œä¸å‹•ç¨‹å¼ç¢¼ã€çš„ç¸½é«”ç›¤é»ï¼Œå…ˆæŠŠç¾æ³è¬›æ¸…æ¥šï¼Œå†åˆ—å‡ºé‚„ç¼ºå“ªäº›é—œéµæª”èˆ‡è³‡æ–™ï¼ˆæˆ‘ä¹Ÿé™„ä¸Šå¿«é€Ÿå–å¾—çš„æ–¹æ³•ï¼‰ã€‚ç­‰ä½ è£œé½Šå¾Œï¼Œæˆ‘å€‘å†æ­£å¼é€²å…¥ã€Œç¬¬ä¸€å€‹æ–°åŠŸèƒ½ã€çš„ç«¯åˆ°ç«¯è¦åŠƒèˆ‡è…³æ‰‹æ¶ã€‚

å°ˆæ¡ˆå¿«é€Ÿç¸½è¦½ï¼ˆä¾ä½ ç›®å‰ä¸Šå‚³çš„æª”æ¡ˆï¼‰

é€™æ˜¯ä¸€å€‹ ASP.NET WebFormsï¼ˆ.NET 4.0ï¼‰ çš„ç¶²ç«™å°ˆæ¡ˆï¼Œæ ¹ç›®éŒ„ç‚º MgmSPï¼Œæœ‰å¤šå€‹åŠŸèƒ½å­è³‡æ–™å¤¾ï¼ˆå¦‚ commcodeã€signoffã€usermgmã€wo ç­‰ï¼‰ï¼Œä¸”ä½¿ç”¨å¤šå€‹å¥—ä»¶ï¼ˆAjaxControlToolkitã€ExcelDataReaderã€iTextSharpã€Newtonsoft.Json ç­‰ï¼‰ã€‚

é—œéµæª”æ¡ˆèˆ‡è·¯å¾‘èƒ½çœ‹åˆ°ï¼šGlobal.asax / Global.asax.vbã€Index.aspx / Index.aspx.vbã€ä»¥åŠé€šç”¨å…ƒä»¶ commcode/CommUtil.vbã€commcode/CommSignOff.vbã€é¡¯ç¤ºé  commcode/ShowData.aspx(.vb) ç­‰ã€‚

bin ç›®éŒ„å¯ä»¥çœ‹åˆ°ç›¸ä¾ DLLï¼ŒåŒ…å« AjaxControlToolkit.dllã€ExcelDataReader*.dllã€iTextSharp.dllã€Newtonsoft.Json.dll ç­‰ã€‚

ä»¥ä¸‹æ˜¯æˆ‘é‡å°ä½ ä¸Šå‚³çš„ç¨‹å¼æª”åšçš„ã€Œé‡é»è§£å‰–ã€ï¼ˆåªé»å‡ºçµæ§‹èˆ‡é¢¨éšªï¼Œä¸æœƒæ”¹ç¨‹å¼æˆ–æ–°å¢åŠŸèƒ½ï¼‰ï¼š

1) Web.configï¼ˆç«™å°è¨­å®šï¼‰

æœ‰ FormsAuthentication èˆ‡ sessionState timeout="30" çš„é…ç½®ï¼›httpRuntime æœ‰æ”¾å¤§ä¸Šå‚³å¤§å°èˆ‡é€¾æ™‚ï¼ˆmaxRequestLength="102400", executionTimeout="600"ï¼‰ã€‚

compilation debug="true"ï¼ˆå»ºè­°æ­£å¼æ©Ÿé—œæ‰ï¼‰ã€‚

connectionStrings ç›®å‰æ˜æ–‡å« sa å¸³å¯†ï¼ˆå¼·çƒˆå»ºè­°ç§»é™¤ã€æœ€å°æ¬Šé™åˆ†é›¢ã€æ­£å¼æ©ŸåŠ å¯†ï¼‰ã€‚

æˆ‘åªæè¿°ç¾è±¡ï¼Œä¸è²¼æ˜æ–‡å…§å®¹ï¼Œé¿å…å¤–æ´©ã€‚

2) Global.asax / Global.asax.vbï¼ˆæ‡‰ç”¨ç¨‹å¼å±¤åˆå§‹èˆ‡æ’ç¨‹ï¼‰

ä»¥ Application è®Šæ•¸ æ”¾äº†ç«™å°æ ¹ URLï¼ˆApplication("http")ï¼Œç¾åœ¨æ˜¯ http://localhost:50601/ï¼‰èˆ‡ä¸Šå‚³æ ¹è·¯å¾‘ Application("localdir") = "C:\sapupload\"ï¼Œå•Ÿå‹•æ™‚å»ºç«‹å¤šå€‹ç›®éŒ„ï¼ˆæœ¬æ©Ÿèˆ‡ Server.MapPath çš†æœ‰ï¼‰ã€‚

ä½¿ç”¨ System.Timers.Timer åœ¨èƒŒæ™¯ thread è§¸ç™¼æ¯æ—¥ 06:00 çš„ã€Œç°½æ ¸ pushã€ï¼šCommSignOff.SignOffPush(Application("http"), 1) èˆ‡ CommSignOff.ToDoListPush(...)ã€‚

é€™ç¨® AppDomain å…§çš„æ’ç¨‹ åœ¨ IIS å›æ”¶ã€AppPool é‡å•Ÿæ™‚ä¸ä¿è­‰æº–æ™‚æˆ–å¯é ï¼Œæœªä¾†æˆ‘å€‘æœƒå»ºè­°æ”¹æˆ Windows å·¥ä½œæ’ç¨‹ï¼ˆTask Schedulerï¼‰â†’ å‘¼å«ç«™å° API ç«¯é» çš„æ¨¡å¼ï¼Œå¯é åº¦é«˜å¾ˆå¤šã€‚

æœ‰ Application("user_sessions") çš„ Session è¨ˆæ•¸å™¨ï¼ˆå–®ç´”çµ±è¨ˆï¼‰ã€‚

3) Index.aspx / Index.aspx.vbï¼ˆé¦–é ï¼æ§åˆ¶å°ï¼‰

Page_Load æœƒè®€ QueryString çš„ act ä¾†é¡¯ç¤ºè¨Šæ¯ï¼ˆå¦‚ signfinishã€setsapã€modifypwdï¼‰ã€‚

æ¬Šé™è®€å–ï¼šperm = CommUtil.GetAssignRight("sg300", Session("s_id")) â†’ ä»£è¡¨ä½ çš„æ¬Šé™æ¨¡å‹æ˜¯ (pid, userId) â†’ permission å­—ä¸²ã€‚

æœ‰ä¸€æ®µæµç¨‹æœƒæª¢æŸ¥ CommSignOff.ArchiveCheck() çš„çµæœï¼Œä¸¦ä»¥ SQL æŸ¥ [@XSFTT] é€™å€‹ SAP B1 è‡ªè¨‚è¡¨ï¼ˆUDTï¼‰ ä¾†é¡¯ç¤ºæœªè¨­å®šæé†’ã€‚

è¨­è¨ˆä¸Šå±¬æ–¼ã€Œé¦–é è¨Šæ¯åŒ¯æµã€è§’è‰²ï¼Œä½†ç›®å‰æ²’æœ‰ çµ±ä¸€çš„ç™»å…¥å®ˆé–€ï¼ˆBasePageï¼‰ï¼Œç™»å…¥é©—è­‰æ‡‰è©²åˆ†æ•£åœ¨ usermgm/login.aspx ç­‰é é¢ã€‚

4) commcode/CommUtil.vbï¼ˆå…±ç”¨å·¥å…·ï¼‰

åŒ…å« MSSQL é€£ç·šåˆå§‹åŒ–ï¼ˆæœ¬æ©Ÿ jtdb èˆ‡ SAP å…¬å¸åº«ï¼‰ã€SAP DI API é€£ç·šï¼ˆSAPbobsCOM.Companyï¼‰ã€ä»¥åŠå¤šå€‹ SelectXXX è³‡æ–™æå–æ–¹æ³•èˆ‡ GridView æ¬„ä½å»ºç½® ç¯„ä¾‹ï¼ˆBOMã€WO é¡¯ç¤ºï¼‰ã€‚

å¤šæ•¸ SQL æ˜¯ç”¨ å­—ä¸²ä¸²æ¥ å»ºæ§‹ï¼ˆâš ï¸ SQL Injection é¢¨éšªï¼‰ï¼Œä¸”ä»¥ sa/é«˜æ¬Šé™é€£ç·šï¼ˆâš ï¸ æ¬Šé™æ¥µå¤§ï¼‰ã€‚

æ¬Šé™æŸ¥è©¢ GetAssignRight(sysid, s_id) è®€å–æœ¬æ©Ÿ dbo.user_permissionnew è¡¨ï¼ˆéœ€è¦æ­¤è¡¨çµæ§‹ï¼‰ã€‚

DI API é€£ç·šè³‡è¨Šå…§åµŒï¼ˆâš ï¸ å»ºè­°æ”¹ç‚ºè¨­å®šæª”ï¼‹æœ€å°æ¬Šé™ DB å¸³è™Ÿï¼Œæ­£å¼æ©ŸåŠ å¯†ï¼‰ã€‚

5) commcode/CommSignOff.vbï¼ˆç°½æ ¸æµç¨‹æ ¸å¿ƒï¼‰

é«”ç©å¾ˆå¤§ï¼ˆ>100KBï¼‰ï¼ŒåŒ…å« ç°½æ ¸æ¨æ’­ã€PDF çµ„ç‰ˆã€æµç¨‹è¨ˆç®— ç­‰é‚è¼¯ï¼Œäº¦æœ‰ å¾é Page é¡åˆ¥å– Session çš„å¯«æ³•ï¼ˆä¾‹å¦‚ Session("usingwhs")ï¼‰ï¼Œé€™åœ¨æ²’æœ‰ HttpContext.Current çš„æƒ…æ³ä¸‹æœƒå‡ºç¾ NREï¼åŸ·è¡Œç·’ç›¸å®¹æ€§å•é¡Œã€‚

å…§å« å•Ÿå‹•ç³»çµ±é€²ç¨‹ï¼ˆProcess.Startï¼‰ æ‰“é–‹ URL çš„ç”¨æ³•ï¼ˆWeb ä¼ºæœå™¨ä¸Šä¸é©åˆï¼ŒIIS èƒŒå¾Œæ²’æœ‰äº’å‹•æ¡Œé¢ï¼‰ã€‚æœªä¾†æ‡‰æ”¹æˆ ä¼ºæœç«¯ç”¢å‡ºâ†’å›å‚³æª”æ¡ˆé€£çµ æˆ– æ’ç¨‹å‘¼å« API â†’ ç”±ç€è¦½å™¨ä¸‹è¼‰ã€‚

6) commcode/ShowData.aspx(.vb)ï¼ˆå…±ç”¨é¡¯ç¤ºé ï¼‰

é€é dtype QueryString åˆ‡æ›é¡¯ç¤ºï¼ˆBOM/WOï¼‰ï¼Œå¯¦ä½œä¸Šç”¨ CommUtil.ShowBomData(gv1, ...) ç­‰æ–¹æ³•æŠŠæŸ¥è©¢çµæœç¹«çµåˆ° GridViewã€‚

å±¬æ–¼ã€Œé€šç”¨è³‡æ–™å±•ç¤ºæ¨¡æ¿ã€ï¼Œä¹‹å¾Œæˆ‘å€‘å¯ä»¥æŠŠå®ƒæŠ½è±¡åŒ–ç‚º æ¨™æº–æŸ¥è©¢â†’DTOâ†’Grid ç¶å®š çš„æ¨£æ¿ï¼Œé¿å…é é éƒ½å¯«ä¸€æ¬¡ã€‚

æˆ‘éœ€è¦ä½ å†æä¾›ï¼ç¢ºèªçš„é—œéµè³‡è¨Šï¼ˆä¸€æ¬¡æ•´ç†ï¼‰

ä½ èªªã€Œè³‡è¨Šä¸å…¨å°±å…ˆä¸è¦é–‹å§‹åšæ–°åŠŸèƒ½ã€ï¼ŒOKâ€”æˆ‘å…ˆæŠŠéœ€è¦çš„æ¸…å–®èˆ‡æœ€å¿«å–å¾—æ–¹å¼éƒ½åˆ—å¥½ï¼›ä½ è£œä¸Šå¾Œæˆ‘å†å‡ºæ‰‹æŠŠç¬¬ä¸€å€‹åŠŸèƒ½ç«¯åˆ°ç«¯æ­èµ·ä¾†ã€‚

A. ç™»å…¥ï¼æˆæ¬Šæ©Ÿåˆ¶çš„æª”æ¡ˆ

usermgm/login.aspx èˆ‡ login.aspx.vbï¼ˆç›®å‰çœ‹ä¸åˆ°å¯¦éš›ç™»å…¥æµç¨‹èˆ‡ Session è¨­ç½®ï¼‰

usermgm/logout.aspx(.vb)ï¼ˆç™»å‡ºæµç¨‹ï¼‰

usermgm/rolesetup.aspx(.vb) æˆ–å…¶ä»–è§’è‰²æˆæ¬Šé ï¼ˆè‹¥æœ‰ï¼‰

MySite1.Master(.vb)ï¼ˆä¸»ç‰ˆé æ˜¯å¦æœ‰ä¾ç™»å…¥ç‹€æ…‹åˆ‡æ›åŠŸèƒ½è¡¨ï¼‰

Web.sitemapï¼ˆå°è¦½çµæ§‹èˆ‡å¯èƒ½çš„æ¬Šé™ç¯€é»ï¼‰
ğŸ‘‰ å–å¾—æ–¹å¼ï¼šè«‹ç›´æ¥ä¸Šå‚³ä¸Šè¿°æª”æ¡ˆåŸå§‹ç¢¼å³å¯ï¼ˆå’Œä½ å‰›å‰›ä¸Šå‚³æ–¹å¼ç›¸åŒï¼‰ã€‚

B. æœ¬æ©Ÿè³‡æ–™åº«ï¼ˆjtdbï¼‰èˆ‡ SAP å…¬å¸åº«çš„è¡¨çµæ§‹

ç‚ºäº†å®‰å…¨èˆ‡ç©©å®šåœ°å°å…¥ã€Œçµ±ä¸€æŸ¥è©¢æ¨£æ¿ + CTE + åƒæ•¸åŒ–ã€ï¼Œæˆ‘éœ€è¦ä»¥ä¸‹æœ€å°‘é›†åˆï¼š

æœ¬æ©Ÿ DB jtdb

dbo.user_permissionnew çš„çµæ§‹ï¼ˆæ¬„åã€å‹åˆ¥ã€PK/UKï¼‰èˆ‡ 3~5 ç­†åŒ¿åç¯„ä¾‹è³‡æ–™ã€‚

è‹¥æœ‰ä½¿ç”¨è€…ä¸»æª”ï¼ˆå¦‚ dbo.users æˆ–é¡ä¼¼ï¼‰ä¹Ÿè«‹æä¾›ã€‚

SAP å…¬å¸åº«ï¼ˆä¾‹å¦‚ JTTST1ï¼‰

æ‰€æœ‰ä½ ç¨‹å¼æœ‰æŸ¥åˆ°çš„ è‡ªè¨‚è¡¨ï¼ˆUDTï¼‰ çš„çµæ§‹ï¼ˆè‡³å°‘ [@XSFTT]ã€[@UPSP]ï¼‰ã€‚

ä¹‹å¾Œç¬¬ä¸€å€‹æ–°åŠŸèƒ½è¦ç”¨åˆ°çš„ æ¨™æº–è¡¨ï¼ˆä¾‹å¦‚ ORDR/RDR1 æˆ–å…¶ä»–ï¼‰ï¼Œä¹Ÿè«‹æŠŠæ¬„ä½æ¸…å–®èˆ‡ç´¢å¼•æä¾›ã€‚

ğŸ‘‰ æœ€å¿«å–å¾—è…³æœ¬ï¼ˆSQL Server 2005 ç›¸å®¹ï¼‰
ï¼ˆè«‹åœ¨å°æ‡‰è³‡æ–™åº«åŸ·è¡Œä¸¦æŠŠçµæœè²¼ä¸Šæˆ–å¦å­˜æ–‡å­—æª”ä¸Šå‚³ï¼‰

-- 1) é¡¯ç¤ºè¡¨æ¬„ä½èˆ‡å‹åˆ¥ï¼ˆé©ç”¨ä¸€èˆ¬è¡¨èˆ‡ SAP UDTï¼‰
SELECT COLUMN_NAME, DATA_TYPE, CHARACTER_MAXIMUM_LENGTH, IS_NULLABLE
FROM INFORMATION_SCHEMA.COLUMNS
WHERE TABLE_NAME = 'user_permissionnew'  -- æˆ–æ”¹æˆ @XSFTT, @UPSP ç­‰
ORDER BY ORDINAL_POSITION;

-- 2) ä¸»éµ/ç´¢å¼•ï¼ˆç°¡è¦ï¼‰
EXEC sp_helpindex 'dbo.user_permissionnew';

-- 3) è¡¨å®šç¾©æ‘˜è¦
EXEC sp_help 'dbo.user_permissionnew';

-- 4) å–å‰å¹¾ç­†åŒ¿åè³‡æ–™ï¼ˆæ³¨æ„é®è”½å€‹è³‡ï¼‰
SELECT TOP 5 * FROM dbo.[user_permissionnew];

-- SAP UDT ç¯„ä¾‹ï¼šè«‹æ”¹è¡¨åå¾Œç…§è·‘
SELECT COLUMN_NAME, DATA_TYPE, CHARACTER_MAXIMUM_LENGTH, IS_NULLABLE
FROM INFORMATION_SCHEMA.COLUMNS
WHERE TABLE_NAME = '@XSFTT';

EXEC sp_help 'dbo.[@XSFTT]';
SELECT TOP 5 * FROM dbo.[@XSFTT];


è‹¥ä½ æœ‰å¤šå…¬å¸åº«ï¼ˆTST/PRDï¼‰ï¼Œè«‹å‘Šè¨´æˆ‘æ­£å¼èˆ‡æ¸¬è©¦åˆ†æµæ–¹å¼ï¼ˆWeb.config çš„ SapSQLConnection æŒ‡å‘å“ªä¸€å€‹ï¼›Session("usingdb") æˆ–å…¶ä»–è®Šæ•¸å¦‚ä½•åˆ‡æ›ï¼‰ã€‚

C. é€£ç·šèˆ‡éƒ¨ç½²ç’°å¢ƒ

Web.configï¼šæ˜¯å¦æœ‰ã€Œæ­£å¼æ©Ÿç‰ˆæœ¬ã€ï¼Ÿï¼ˆç›®å‰çœ‹èµ·ä¾†æ˜¯é–‹ç™¼ç·šä¸Šæ··ç”¨ï¼›æ­£å¼æ©Ÿéœ€ debug="false"ã€customErrors="On"ã€connectionStrings åŠ å¯†ï¼‰

IIS æ‡‰ç”¨ç¨‹å¼é›†å€ï¼ˆ.NET v4.0ã€Integrated Modeï¼Ÿï¼‰

æ˜¯å¦æœ‰ HTTPS èˆ‡æ­£å¼ç¶²åŸŸï¼Ÿï¼ˆApplication("http") æœªä¾†æœƒæ”¹ç”¨ Request.Url.GetLeftPart(UriPartial.Authority) æˆ–è¨­å®šæª”ï¼‰

SAP DI API ç‰ˆæœ¬ã€License Serverã€å…¬å¸åº«åç¨±ï¼ˆä¾›é€£ç·šæ¨¡æ¿ç”¨ï¼›ä¸ç”¨çµ¦å¯†ç¢¼ï¼‰

å…ˆè¡Œé¢¨éšªèˆ‡å¯å¿«é€Ÿæ”¹å–„ï¼ˆä¸æ”¹åŠŸèƒ½ã€ä¸ç ´æ¶æ§‹ï¼‰

é€™äº›æ˜¯ã€Œä¸å‹•åŠŸèƒ½ / ä¸å‹• UIã€å³å¯åšçš„å®‰å…¨èˆ‡ç©©å®šæ€§æå‡ï¼›ç­‰ä½ ç¢ºèªå¾Œï¼Œæˆ‘å¯ä»¥å¹«ä½ ä¸€æ¬¡çµ¦å‡ºå®‰å…¨ä¿®æ”¹ PR çš„å»ºè­°å·®ç•°ç¨¿ã€‚

ç§»é™¤ sa æ˜æ–‡èˆ‡é«˜æ¬Šé™é€£ç·šï¼š

ç‚ºã€Œè®€å–ã€èˆ‡ã€Œå¯«å…¥ï¼ˆåƒ… DI API éœ€ SAP å¸³è™Ÿï¼‰ã€åˆ†åˆ¥å»ºç«‹æœ€å°æ¬Šé™å¸³è™Ÿã€‚

æ­£å¼æ©Ÿ connectionStrings ç”¨ aspnet_regiis -pef connectionStrings åŠ å¯†ã€‚

æ‰€æœ‰ SQL æ”¹ç‚ºåƒæ•¸åŒ–ï¼ˆ2005 OKï¼‰ï¼Œä¸¦çµ±ä¸€è¶…æ™‚èˆ‡éŒ¯èª¤è™•ç†ã€‚

é—œé–‰æ­£å¼æ©Ÿ debug="true"ã€é–‹å•Ÿ customErrorsï¼Œè¨˜éŒ„åˆ°æª”/DBã€‚

ç§»é™¤ Web ä¼ºæœå™¨ä¸Šçš„ Process.Startï¼Œä»¥ã€Œä¼ºæœç«¯ç”¢å‡ºæª”æ¡ˆ â†’ ä½¿ç”¨è€…ä¸‹è¼‰ã€æˆ–ã€Œæ’ç¨‹å™¨å‘¼å« APIã€æ›¿ä»£ã€‚

æ’ç¨‹ï¼šæŠŠ Timer æ”¹ç‚º Windows å·¥ä½œæ’ç¨‹ â†’ å‘¼å«å—ä¿è­·çš„ APIï¼ˆæˆ–æœ€å°‘ç”¨ Application_Start ä¿éšªé‡æ’ï¼Œä½†æœ€ä½³ä»æ˜¯å¤–éƒ¨æ’ç¨‹ï¼‰ã€‚

é›†ä¸­ç™»å…¥å®ˆé–€ï¼šå»ºç«‹ BasePage æª¢æŸ¥ç™»å…¥ï¼ˆæˆ– URL æˆæ¬Šï¼‰ï¼Œå°‡é›¶æ•£ Session æª¢æŸ¥é›†ä¸­åŒ–ï¼ˆä¸å‹•ä»»ä½•åŠŸèƒ½é æµç¨‹ï¼‰ã€‚

æˆ‘å»ºè­°çš„ã€Œç¬¬ä¸€å€‹æ–°åŠŸèƒ½ã€å€™é¸ï¼ˆç­‰ä½ è£œé½Šè³‡è¨Šå¾Œå†é¸ï¼‰

æˆ‘ä¸æœƒå…ˆåšï¼Œå…ˆè®“ä½ æŒ‘ï¼š

çµ±ä¸€ç™»å…¥å®ˆé–€ + æ¬Šé™å®£å‘ŠåŒ–ï¼šBasePage + [Authorize("sgXXX: m/n/d")] è¼•é‡å¯¦ä½œï¼ˆWebForms å¯ç”¨è‡ªè¨‚å±¬æ€§/Helperï¼‰ï¼ŒæŠŠç¾æœ‰çš„ Session("s_id") èˆ‡ GetAssignRight è®Šæˆä¸€æ¢ç·šã€‚

é€šç”¨æŸ¥è©¢æ¨£æ¿ï¼ˆCTE + åƒæ•¸åŒ– + åˆ†é ï¼‰å¥—é€² ShowDataï¼šè®“æ‰€æœ‰è³‡æ–™æŸ¥è©¢é ç”¨åŒä¸€æ¨¡æ¿ï¼ˆæ¬„=æ¬„ã€åˆ—=åˆ—ï¼‰ï¼Œå…ˆæŒ‘ä¸€å¼µä½ æœ€å¸¸æŸ¥çš„è¡¨ï¼ˆä¾‹å¦‚ ORDR/RDR1 æˆ– WO æ¸…å–®ï¼‰åšç¤ºç¯„ã€‚

ç°½æ ¸æ¨æ’­å¤–ç§»ç‚º API + å·¥ä½œæ’ç¨‹ï¼šä¿ç•™ CommSignOff çš„é‚è¼¯ï¼Œä½†è®“è§¸ç™¼èˆ‡åŸ·è¡Œè„«é‰¤ï¼Œå¯é ä¸”å¯ç›£æ§ã€‚

ä¸‹ä¸€æ­¥ï¼ˆè«‹ä½ ç›´æ¥å›æˆ‘ä»¥ä¸‹å…§å®¹ï¼‰

ä¸Šå‚³ A ç¯€æ‰€åˆ—çš„ç™»å…¥ï¼æˆæ¬Šç›¸é—œæª”æ¡ˆï¼ˆå°¤å…¶ usermgm/login.aspx.vbã€logout.aspx.vbã€MySite1.Master.vbã€Web.sitemapï¼‰ã€‚

åœ¨ B ç¯€å°æ‡‰è³‡æ–™åº«åŸ·è¡Œè…³æœ¬ï¼ŒæŠŠçµæœè²¼ä¸Šæˆ–ä¸Šå‚³æ–‡å­—æª”ï¼ˆè‡³å°‘ user_permissionnewã€[@XSFTT]ã€ä»¥åŠä½ ç¬¬ä¸€å€‹æƒ³åšçš„åŠŸèƒ½æœƒç”¨åˆ°çš„æ¨™æº–è¡¨ï¼‰ã€‚

ç¢ºèª C ç¯€çš„éƒ¨ç½²ç’°å¢ƒè³‡è¨Šï¼ˆæ­£å¼æ©Ÿï¼æ¸¬è©¦æ©Ÿã€IISã€HTTPSã€SAP ç‰ˆæœ¬ï¼‰ã€‚

æ”¶åˆ°é€™äº›å¾Œï¼Œæˆ‘æœƒï¼š

ç”¢å‡ºä½ çš„ç¾æ³æ¶æ§‹åœ–ï¼ˆæ¨¡çµ„ã€è³‡æ–™æµã€å‘¼å«é—œä¿‚ï¼‰

æå‡ºç¬¬ä¸€å€‹åŠŸèƒ½çš„ä¸‰ç‰ˆè…³æ‰‹æ¶ï¼ˆè®€ã€é¡¯ç¤ºã€å›å¯«ï¼è‹¥é¸æ“‡çš„æ˜¯ç™»å…¥å®ˆé–€ï¼Œå‰‡æä¾›æœ€å°ä¾µå…¥å¯¦ä½œï¼‰

é™„ä¸Šå®‰å…¨ä¿®è£œå»ºè­°çš„ä¿®æ”¹é»ï¼ˆå·®ç•°ç¨¿/ç‰‡æ®µï¼‰ï¼Œä¿è­‰ä¸ç ´å£æ—¢æœ‰åŠŸèƒ½

éœ€è¦æˆ‘å¦å¤–çµ¦ä¸€å¥— ã€Œè³‡æ–™è¡¨çµæ§‹è‡ªå‹•åŒ¯å‡ºã€çš„å°å·¥å…· SQLï¼ˆæŠŠæŸäº›è¡¨çš„æ¬„ä½ã€ç´¢å¼•ã€å¤–éµä¸€æ¬¡åŒ¯æˆ CSVï¼‰å—ï¼Ÿè‹¥è¦ï¼Œæˆ‘å¯ä»¥å…ˆçµ¦ä¸€ç‰ˆ SQL 2005 ç›¸å®¹ çš„è…³æœ¬ï¼Œè®“ä½ ä¸€éµç”¢å‡ºè¦çµ¦æˆ‘çš„æ¬„ä½æ¸…å–®èˆ‡ç´¢å¼•æ‘˜è¦ã€‚

ï¼ˆ2025å¹´09æœˆ19æ—¥16æ™‚10åˆ†ï¼Œå°åŒ—ï¼‰

ä½ èªªï¼š
addsapid.aspx.vb
æª”æ¡ˆ
login.aspx
æª”æ¡ˆ
login.aspx.vb
æª”æ¡ˆ
logout.aspx
æª”æ¡ˆ
logout.aspx.vb
æª”æ¡ˆ
rolesetup.aspx
æª”æ¡ˆ
rolesetup.aspx.vb
æª”æ¡ˆ
addsapid.aspx
æª”æ¡ˆ
MySite1.Master.vb
æª”æ¡ˆ
Web.sitemap
æª”æ¡ˆ
ä»¥ä¸‹æ˜¯ä½ çµ¦æˆ‘çš„queryæŸ¥è©¢çš„çµæœï¼Œç”±ä¸Šåˆ°ä¸‹ä¾åºï¼Œæ¯ä¸€æ®µç”±ç©ºæ¬„éš”é–‹ã€‚
å¦‚æœé‚„æœ‰æˆ‘æ¼æ‰æ²’çµ¦çš„è«‹å†å‘Šè¨´æˆ‘ï¼Œ
æˆ‘çš„ç¬¬ä¸€éšæ®µæ˜¯è¦æ–°å¢ä¸€å€‹åŠŸèƒ½ï¼Œæ›åˆ°é€™å€‹å¹³å°ä¸Šï¼Œ
è«‹å…ˆä¸è¦æ€¥è‘—å»ºè­°æˆ‘å„ªåŒ–åŸå…ˆçš„åŠŸèƒ½æˆ–æ˜¯è£œå¼·æ¼æ´èˆ‡å®‰å…¨æ€§ï¼Œ
è«‹å…ˆç¢ºå®šæ˜¯å¦å¾—åˆ°è¶³å¤ çš„è³‡è¨Šï¼Œç„¶å¾Œæˆ‘æœƒå‘Šè¨´ä½ æˆ‘æƒ³è¦çš„ç¬¬ä¸€å€‹åŠŸèƒ½æ˜¯ä»€éº¼ï¼Œ
æˆ‘å€‘å†é–‹å§‹è¨è«–å¦‚ä½•é€²è¡Œï¼Œè¬è¬ã€‚

num	int	NULL	NO
id	varchar	15	NO
pid	varchar	15	NO
permission	varchar	15	NO

PK_user_permissionnew	clustered, unique, primary key located on PRIMARY	num

user_permissionnew	dbo	user table	2022-09-04 10:06:58.083

num	int	no	4	10   	0    	no	(n/a)	(n/a)	NULL
id	varchar	no	15	     	     	no	no	no	Chinese_Taiwan_Stroke_CI_AS
pid	varchar	no	15	     	     	no	no	no	Chinese_Taiwan_Stroke_CI_AS
permission	varchar	no	15	     	     	no	no	no	Chinese_Taiwan_Stroke_CI_AS

num	1	1	0

sfid	smallint	NULL	NO
sfname	nvarchar	50	NO
sftype	tinyint	NULL	NO
sftypenote	nvarchar	30	NO
deptcode	varchar	50	NO
todoflag	tinyint	NULL	NO
selfform	tinyint	NULL	NO

@XSFTT	dbo	user table	2024-05-08 11:38:50.983

sfid	smallint	no	2	5    	0    	no	(n/a)	(n/a)	NULL
sfname	nvarchar	no	100	     	     	no	(n/a)	(n/a)	Chinese_PRC_CI_AS
sftype	tinyint	no	1	3    	0    	no	(n/a)	(n/a)	NULL
sftypenote	nvarchar	no	60	     	     	no	(n/a)	(n/a)	Chinese_PRC_CI_AS
deptcode	varchar	no	50	     	     	no	no	no	Chinese_PRC_CI_AS
todoflag	tinyint	no	1	3    	0    	no	(n/a)	(n/a)	NULL
selfform	tinyint	no	1	3    	0    	no	(n/a)	(n/a)	NULL

Code	nvarchar	8	NO
Name	nvarchar	30	NO
U_model	nvarchar	-1	YES
U_cspec	nvarchar	-1	YES
U_cusname	nvarchar	-1	YES
U_sales_area	nvarchar	-1	YES
U_amount	smallint	NULL	YES
U_shipdate	datetime	NULL	YES
U_createdate	datetime	NULL	YES
U_sales_person	nvarchar	-1	YES
U_camera_pixel	nvarchar	-1	YES
U_resolution	nvarchar	-1	YES
U_comment	nvarchar	-1	YES
U_status	nvarchar	-1	YES
U_mtype	nvarchar	-1	YES
U_updcount	smallint	NULL	YES
U_lastupdmemo	nvarchar	-1	YES
U_ptype	smallint	NULL	YES
U_shiploc	nvarchar	-1	YES

@UPSP	dbo	user table	2022-05-06 07:39:59.083

Code	nvarchar	no	16	     	     	no	(n/a)	(n/a)	Chinese_PRC_CI_AS
Name	nvarchar	no	60	     	     	no	(n/a)	(n/a)	Chinese_PRC_CI_AS
U_model	nvarchar	no	-1	     	     	yes	(n/a)	(n/a)	Chinese_PRC_CI_AS
U_cspec	nvarchar	no	-1	     	     	yes	(n/a)	(n/a)	Chinese_PRC_CI_AS
U_cusname	nvarchar	no	-1	     	     	yes	(n/a)	(n/a)	Chinese_PRC_CI_AS
U_sales_area	nvarchar	no	-1	     	     	yes	(n/a)	(n/a)	Chinese_PRC_CI_AS
U_amount	smallint	no	2	5    	0    	yes	(n/a)	(n/a)	NULL
U_shipdate	datetime	no	8	     	     	yes	(n/a)	(n/a)	NULL
U_createdate	datetime	no	8	     	     	yes	(n/a)	(n/a)	NULL
U_sales_person	nvarchar	no	-1	     	     	yes	(n/a)	(n/a)	Chinese_PRC_CI_AS
U_camera_pixel	nvarchar	no	-1	     	     	yes	(n/a)	(n/a)	Chinese_PRC_CI_AS
U_resolution	nvarchar	no	-1	     	     	yes	(n/a)	(n/a)	Chinese_PRC_CI_AS
U_comment	nvarchar	no	-1	     	     	yes	(n/a)	(n/a)	Chinese_PRC_CI_AS
U_status	nvarchar	no	-1	     	     	yes	(n/a)	(n/a)	Chinese_PRC_CI_AS
U_mtype	nvarchar	no	-1	     	     	yes	(n/a)	(n/a)	Chinese_PRC_CI_AS
U_updcount	smallint	no	2	5    	0    	yes	(n/a)	(n/a)	NULL
U_lastupdmemo	nvarchar	no	-1	     	     	yes	(n/a)	(n/a)	Chinese_PRC_CI_AS
U_ptype	smallint	no	2	5    	0    	yes	(n/a)	(n/a)	NULL
U_shiploc	nvarchar	no	-1	     	     	yes	(n/a)	(n/a)	Chinese_PRC_CI_AS
ChatGPT èªªï¼š
å·²æ€è€ƒ 26s

æ”¶åˆ°ä½ æä¾›çš„æª”æ¡ˆèˆ‡æŸ¥è©¢çµæœï¼Œæˆ‘å…ˆç¢ºèªç›®å‰ã€Œèƒ½æŒæ¡åˆ°çš„é—œéµé»ã€èˆ‡ã€Œå¯èƒ½é‚„éœ€è¦çš„å°è£œä»¶ã€ã€‚æˆ‘ä¸æœƒå»ºè­°å„ªåŒ–æˆ–è£œå¼·ä»»ä½•ç¾æœ‰åŠŸèƒ½ï¼Œåƒ…åšæ˜¯å¦è¶³å¤ å•Ÿå‹•ç¬¬ä¸€å€‹æ–°åŠŸèƒ½è¦åŠƒçš„æ ¸å°ã€‚

æˆ‘å·²ç¶“æŒæ¡çš„é‡é»

å°ˆæ¡ˆå‹æ…‹ï¼šASP.NET WebFormsï¼ˆ.NET 4.0ï¼‰ã€‚æœ‰ Global.asax(.vb) èˆ‡é¦–é  Index.aspx(.vb)ï¼Œä»¥åŠé€šç”¨é é¢ ShowData.aspx(.vb)ã€å…±ç”¨å…ƒä»¶ commcode/CommUtil.vbã€commcode/CommSignOff.vbã€ä¸»ç‰ˆé  MySite1.Master.vbã€ç™»å…¥/ç™»å‡º/è§’è‰²é  login.aspx(.vb), logout.aspx(.vb), rolesetup.aspx(.vb)ã€æ–°å¢ SAP ID addsapid.aspx(.vb)ã€Web.sitemapï¼ˆå°è¦½ï¼‰ã€‚

ç™»å…¥/Sessionï¼šWeb.config ä½¿ç”¨ FormsAuthenticationï¼ˆtimeout=60ï¼‰ï¼ŒsessionState timeout=30ã€‚Index.aspx.vb æœƒè®€å–ä½¿ç”¨è€…è­˜åˆ¥èˆ‡æ¬Šé™ï¼ˆç”± CommUtil.GetAssignRight(pid, s_id) æä¾›ï¼‰ã€‚

æ¬Šé™æ¨¡å‹ï¼šæœ¬æ©Ÿ DB çš„ dbo.user_permissionnewï¼ˆnum PK, id, pid, permissionï¼‰ã€‚CommUtil.GetAssignRight ä»¥ (pid, id) å–å›å°æ‡‰çš„ permissionã€‚

å…±ç”¨é¡¯ç¤ºæ¨¡æ¿ï¼šShowData.aspx.vb ä»¥ dtype åˆ‡æ›ï¼Œé€é CommUtil.ShowBomDataã€ShowWoData ç¶ GridViewï¼ˆä¹‹å¾Œå¯ç›´æ¥å¥—ä½ è¦çš„æ–°åŠŸèƒ½ä¹‹æŸ¥è©¢çµæœï¼‰ã€‚

ç«™å°å±¤ç´šè¨­å®šï¼šGlobal.asax.vb è¨­å®š Application("http") èˆ‡ Application("localdir")ã€å»ºç«‹å¿…è¦è³‡æ–™å¤¾ï¼Œä¸¦ç”¨è¨ˆæ™‚å™¨åœ¨ 06:00 è§¸ç™¼ç°½æ ¸æ¨é€ï¼ˆå‘¼å« CommSignOffï¼‰ã€‚

èˆ‡ SAP çš„ä»‹æ¥ï¼šè®€å–é¢ï¼ˆSQL æŸ¥è©¢ï¼‰èˆ‡é¡¯ç¤ºæ¨¡æ¿åœ¨ CommUtil/ShowDataï¼›å¯«å…¥é¢ï¼ˆDI APIï¼‰ç›¸é—œé¡åˆ¥åœ¨ CommUtil/CommSignOff å…§ã€‚

ä½ æä¾›çš„è³‡æ–™è¡¨çµæ§‹ï¼š

dbo.user_permissionnewï¼ˆæœ¬æ©Ÿæ¬Šé™è¡¨ï¼‰ã€‚

SAP UDT [@XSFTT]ï¼ˆç°½æ ¸/æé†’è¨­å®šç›¸é—œï¼‰ã€‚

SAP UDT [@UPSP]ï¼ˆå«å®¢è£½æ¬„ä½ U_model/U_cspecâ€¦ç­‰ï¼‰ã€‚

ç›®å‰å·²è¶³å¤ é–‹å§‹è¦åŠƒç¬¬ä¸€å€‹æ–°åŠŸèƒ½çš„éƒ¨åˆ†

åªè¦ä½ çš„ç¬¬ä¸€å€‹åŠŸèƒ½ä¸»è¦æ˜¯ã€Œå¢ä¸€å€‹æŸ¥è©¢æˆ–æ“ä½œé ã€æ›åœ¨æ—¢æœ‰å¹³å°ï¼ˆä¾‹å¦‚ï¼šæŸ¥æŸäº›å–®æ“š â†’ é¡¯ç¤ºçµ¦ä½¿ç”¨è€… â†’ è¦–éœ€è¦åšå¯«å›ï¼‰ï¼Œå°±å·²ç¶“å¤ æˆ‘èµ·æ‰‹è¦åŠƒç«¯åˆ°ç«¯è…³æ‰‹æ¶ï¼ˆUI/æŸ¥è©¢/é¡¯ç¤º/å¿…è¦æ™‚ DI API å¯«å…¥ï¼‰ï¼Œå› ç‚ºï¼š

æˆ‘å·²çœ‹åˆ°ä½ çš„ç™»å…¥/Session èˆ‡æ¬Šé™å–å¾—æ–¹å¼ï¼ˆFormsAuth + GetAssignRightï¼‰ã€‚

æˆ‘ä¹Ÿæœ‰ç¾æˆå¯æ²¿ç”¨çš„é¡¯ç¤ºé ç¯„å¼ï¼ˆShowData + GridViewï¼‰ï¼Œå¯ç›´æ¥å¥—ä½ è¦çš„è³‡æ–™æ¬„/åˆ—ï¼›

å¯«å…¥è‹¥è¦ç”¨ DI APIï¼ŒCommUtil/CommSignOff çš„é€£ç·š/å‘¼å«ç¯„å¼ä¹Ÿå·²åœ¨å°ˆæ¡ˆä¸­ã€‚

å¯èƒ½é‚„éœ€è¦çš„æ¥µç°¡è£œä»¶ï¼ˆè¦–ä½ çš„ç¬¬ä¸€å€‹åŠŸèƒ½è€Œå®šï¼‰

ä»¥ä¸‹ä¸æ˜¯è¦ä½ ç¾åœ¨å°±æä¾›ï¼Œè€Œæ˜¯ç•¶ä½ èªªå‡ºã€Œç¬¬ä¸€å€‹åŠŸèƒ½ã€æ™‚ï¼Œæˆ‘æ‰æŒ‘å¿…è¦çš„è·Ÿä½ è¦ã€‚å…ˆæŠŠæ¸…å–®åˆ—åœ¨é€™è£¡ï¼Œä½ ä¸€çœ‹å°±çŸ¥é“æˆ‘æœƒæ€éº¼æ‹¿è³‡æ–™ï¼Œä¸ç”¨ä¾†å›çŒœï¼š

ç›®æ¨™è³‡æ–™è¡¨çµæ§‹ï¼ˆåªé™æ–¼æ–°åŠŸèƒ½æœƒç”¨åˆ°çš„é‚£å¹¾å¼µè¡¨ï¼‰ï¼š

è‹¥æ˜¯ SAP æ¨™æº–è¡¨ï¼ˆå¦‚ ORDR/RDR1ã€OINV/INV1â€¦ï¼‰ï¼šè«‹çµ¦ æ¬„ä½æ¸…å–®ï¼ˆINFORMATION_SCHEMA.COLUMNS çµæœï¼‰å³å¯ï¼›

è‹¥æ˜¯ SAP UDT/UDFï¼šä¹Ÿè«‹çµ¦æ¬„ä½æ¸…å–®ã€‚

è‹¥éœ€è¦åšã€ŒæŸ¥è©¢æ¢ä»¶ä¸‹æ‹‰ã€ä¹‹é¡çš„ UIï¼Œè«‹æä¾›è©²ä¸‹æ‹‰ä¾†æºè¡¨çš„æ¬„ä½æ¸…å–®ï¼ˆä¾‹å¦‚å®¢æˆ¶ã€å€‰åˆ¥ã€äººå“¡ï¼‰ã€‚
ï¼ˆä½ å·²ç¶“ç¤ºç¯„éä¸€æ¬¡æ€éº¼æä¾›ï¼Œæˆ‘æœƒç”¨ç›¸åŒæ–¹å¼è§£æã€‚ï¼‰

å…¬å¸åº«ä»£è™Ÿ èˆ‡ ä½ å¹³å°å¦‚ä½•é¸åº« çš„æ–¹å¼ï¼ˆä¾‹å¦‚ç”¨ Session("usingdb") æˆ–å›ºå®šä¸€å€‹ DBï¼‰ã€‚ä¸éœ€è¦æä¾›ä»»ä½•å¯†ç¢¼ï¼Œåªè¦åå­—ï¼ˆåƒ SBOTST / SBOPRDï¼‰å³å¯ã€‚

ï¼ˆè‹¥æ–°åŠŸèƒ½åŒ…å«å¯«å…¥ SAPï¼‰è«‹å‘Šè¨´æˆ‘è¦å¯«å…¥çš„å–®æ“šé¡å‹ï¼ˆä¾‹å¦‚ï¼šé€è²¨ã€ç™¼ç¥¨ã€å…§éƒ¨å°å¸³â€¦ï¼‰ï¼Œæˆ‘æœƒç”¨ä½ å°ˆæ¡ˆæ—¢æœ‰çš„ DI API æ–¹å¼å»ºé››å½¢ã€‚

ç¸½ä¹‹ï¼šç­‰ä½ èªªå‡ºã€Œç¬¬ä¸€å€‹åŠŸèƒ½ã€æ˜¯ä»€éº¼å¾Œï¼Œæˆ‘åªæœƒå‘ä½ ç´¢å–é‚£å€‹åŠŸèƒ½å¿…è¦çš„è¡¨çµæ§‹å°æ¸…å–®ï¼Œç„¶å¾Œå°±èƒ½ç›´æ¥é–‹å§‹è¦åŠƒèˆ‡å‹•å·¥ï¼ˆæ²¿ç”¨ä½ ç¾æœ‰çš„é é¢æ¨¡æ¿èˆ‡ç¿’æ…£ï¼‰ã€‚

ä½ å¯ä»¥å‘Šè¨´æˆ‘ç¬¬ä¸€å€‹æ–°åŠŸèƒ½æ˜¯ä»€éº¼äº†ï¼
ï¼ˆç¯„ä¾‹ï¼šã€Œæ–°å¢ä¸€å€‹ã€éŠ·å”®è¨‚å–®æŸ¥è©¢ã€é ï¼šä¾æ—¥æœŸ/å®¢æˆ¶æŸ¥ ORDR/RDR1ï¼Œé¡¯ç¤ºæ¬„ä½ A..Nï¼Œä¸¦å¯å‹¾é¸å¤šåˆ—ä¸€éµç”¢ç”Ÿé€è²¨å–®ã€ã€‚é€™æ¨£æˆ‘å°±çŸ¥é“è¦è·Ÿä½ è¦ ORDR/RDR1 çš„æ¬„ä½æ¸…å–®ï¼ŒåŠæ˜¯å¦éœ€è¦ ODLN/DLN1 çš„å¯«å…¥é››å½¢ã€‚ï¼‰

ï¼ˆ2025å¹´09æœˆ19æ—¥16æ™‚28åˆ†ï¼Œå°åŒ—ï¼‰

ä½ èªªï¼š
æˆ‘æƒ³åœ¨é€™é‚Šå®šç¾©ä¹‹å¾Œæœƒç”¨åˆ°çš„ç‰©ä»¶æ ¼å¼ï¼Œ
ä¾‹å¦‚ç›®å‰å®šç¾©çš„å–®æ“š
ç‰©ä»¶åç¨±ç‚ºï¼šB1äº¤æ˜“
B1äº¤æ˜“ç‰©ä»¶ 
æœ‰æ–°å¢/æœå°‹/æ›´æ–°æ¨¡å¼
äº¤æ˜“çš„è¡¨å–®ä»‹é¢éƒ½ä¸€æ¨¡ä¸€æ¨£ï¼Œ
ä¸åŒæ¨¡å¼ä¸‹æ¬„ä½é¡è‰²æœƒæœ‰æ‰€è®ŠåŒ–ã€‚
é¡è‰²æœ‰ï¼š
1.å¯ç·¨è¼¯è‰²(é è¨­ç™½ï¼Œé™¤éæ¬„ä½è¨­å®šç‰¹åˆ¥æŒ‡å®š)
2.ä¸å¯æŒ‡å®šè‰²(é è¨­ç°ï¼Œé™¤éæ¬„ä½è¨­å®šç‰¹åˆ¥æŒ‡å®š)
3.æœå°‹è‰²(é è¨­é»ƒï¼Œé™¤éæ¬„ä½è¨­å®šç‰¹åˆ¥æŒ‡å®š)
	æ–°å¢æ¨¡å¼ï¼š
		æœ€é–‹å§‹é€²å…¥è¡¨å–®æ™‚é è¨­ç‚ºæ–°å¢æ¨¡å¼ï¼Œæ‰€æœ‰å¯è¼¸å…¥çš„æ¬„ä½ç‚ºå¯ç·¨è¼¯è‰²ï¼Œä¸å¯è¼¸å…¥çš„æ¬„ä½ç‚ºä¸å¯æŒ‡å®šè‰²ï¼Œ
		æœå°‹æ¨¡å¼ï¼šé€²å…¥æœå°‹æ¨¡å¼å¾Œï¼ŒåŸå…ˆåœ¨æ–°å¢æ¨¡å¼ä¸­å¯è¼¸å…¥çš„æ¬„ä½è®Šç‚ºæœå°‹è‰²ï¼Œä¸å¯è¼¸å…¥çš„æ¬„ä½ç‚ºä¸å¯æŒ‡å®šè‰²ï¼Œ
					ä½¿ç”¨è€…åœ¨ä»»ä½•ä¸€å€‹æœå°‹è‰²æ¬„ä½è¼¸å…¥å€¼éƒ½æœƒè¦–åŒè©²æ¬„ä½çš„ç¯©é¸æ¢ä»¶å€¼ï¼Œ
					ç•¶ä½¿ç”¨è€…è¼¸å…¥å®Œä»¥å¾Œï¼Œå°±æœƒä»¥æ¯å€‹æœ‰ä½¿ç”¨è€…è¼¸å…¥å€¼çš„æ¬„ä½èˆ‡å€¼åšç‚ºç¯©é¸æ¢ä»¶æœå°‹ç³»çµ±å–®æ“šã€‚
		æ›´æ–°æ¨¡å¼ï¼šä½¿ç”¨è€…èª¿å‡ºæ­·å²å–®æ“šæ™‚è¦–åŒæ›´æ–°æ¨¡å¼ï¼Œæ‰€æœ‰å¯æ›´æ–°æ¬„ä½ç‚ºå¯ç·¨è¼¯è‰²ä¸”å¯ç·¨è¼¯ï¼Œä¸å¯æ›´æ–°æ¬„ä½ç‚ºä¸å¯æŒ‡å®šè‰²ï¼Œä¸”ä¸å¯ç·¨è¼¯ã€‚
å­ç‰©ä»¶æœ‰
è¡¨é ­
è¡¨èº«
	é ç±¤
		1.å…§å®¹(B1çš„æœå‹™é¡å‹æ¡è³¼å–®æ˜ç´°)
		2.ç‰©æµ
		3.æœƒè¨ˆ
		4.é™„ä»¶
		
		æ¬„ä½ï¼š
			ä¸»æª”è¨Šæ¯æ¬„ä½(å¿…é€£çµç³»çµ±ä¸»æª”è³‡æ–™)
				é›™æ“Šä¸»æª”è¨Šæ¯æ¬„ä½æœƒå½ˆå‡ºä¸»æª”è³‡æ–™çš„è³‡è¨Šè¦–çª—
			äº¤æ˜“è¨Šæ¯æ¬„ä½
			
				æ¬„ä½è³‡æ–™é¡å‹ï¼š
					æ–‡å­—æ¬„ä½
					æ—¥æœŸæ¬„ä½(å¸¶æ—¥æœŸé¸æ“‡æ§ä»¶)(é è¨­é¸æ“‡ç•¶å¤©)
					ç‰©ä»¶
					CheckBox
					æ¸…å–®(ä¸»æª”è¨Šæ¯æ¸…å–®/äº¤æ˜“è¨Šæ¯æ¸…å–®)
					Radio Button

				è¨Šæ¯æ¬„ä½çš„å±¬æ€§
					1.Searchableï¼šå¯æœå°‹/ä¸å¯æœå°‹
					2.Updatableï¼šå¯æ›´æ–°/ä¸å¯æ›´æ–°
					3.Editableï¼šå¯ç·¨è¼¯/ä¸å¯ç·¨è¼¯
					4.Selectableï¼šå¯æŒ‡å®š/ä¸å¯æŒ‡å®š
					5.æœ‰æœ‰æ•ˆå€¼/ç„¡æœ‰æ•ˆå€¼
						æœ‰æ•ˆå€¼æ¸…å–®
					6.æœ‰é è¨­å€¼/ç„¡é è¨­å€¼
						5-1.å¾æœ‰æ•ˆå€¼æ“‡ä¸€æŒ‡å®šé è¨­å€¼ä»£ç¢¼
						5-2.é è¨­ç³»çµ±æŸ¥è©¢ï¼Œæ ¹æ“šæ¢ä»¶è§¸ç™¼ç³»çµ±æŸ¥è©¢å–å€¼
					7.æœ‰é€£çµå­æ˜ç´°è¡¨å–®/ç„¡é€£çµå­æ˜ç´°è¡¨å–®(é›™æ“Šæ¬„ä½å½ˆå‡ºå­æ˜ç´°è¡¨å–®çš„è¦–çª—)
					8.å¿…å¡«/å¯é¸

B1äº¤æ˜“ç‰©ä»¶
	è¡¨é ­ç‰©ä»¶
		æ¬„ä½ç‰©ä»¶
	è¡¨èº«ç‰©ä»¶
		é ç±¤ç‰©ä»¶
			æ¬„ä½ç‰©ä»¶

ç‰©ä»¶éšå±¤ä»¥ç¸®æ’æ•´ç†ï¼Œè«‹ç‚ºæˆ‘è©³é–±å¾Œçµ±æ•´ï¼Œä¸¦ç”¨Jsonæ ¼å¼è¡¨ç¤ºï¼Œ
è¦æ ¼è‹¥æœ‰çŸ›ç›¾æˆ–æ˜é¡¯çš„éŒ¯èª¤æˆ–å…¶å®ƒå»ºè­°è«‹æå‡ºä¾†è®“æˆ‘ä¿®æ­£æˆ–åƒè€ƒã€‚
ChatGPT èªªï¼š
å·²æ€è€ƒ 6s

å¤ªå¥½äº†ï¼æˆ‘å…ˆæŠŠä½ æè¿°çš„ã€ŒB1äº¤æ˜“ã€æ•´ç†æˆå¯è½åœ°çš„ JSON è¦æ ¼ï¼ˆSchema + ç¯„ä¾‹ï¼‰ï¼Œä¹‹å¾Œä»»ä½•æ–°åŠŸèƒ½ï¼å–®æ“šéƒ½èƒ½æ²¿ç”¨åŒä¸€å¥—æ ¼å¼èˆ‡è¡Œç‚ºè¦å‰‡ã€‚æœ€å¾Œæˆ‘ä¹Ÿåˆ—å‡ºå¹¾å€‹å¯èƒ½çš„çŸ›ç›¾èˆ‡éœ€è¦é‡æ¸…é»ï¼Œä½ ç¢ºèªå¾Œæˆ‘å†å¾®èª¿ã€‚

B1äº¤æ˜“ï¼šç‰©ä»¶è¦æ ¼ï¼ˆSchemaï¼‰
{
  "object": "B1Transaction",
  "version": "1.0.0",
  "modes": ["create", "search", "update"],
  "ui": {
    "colors": {
      "editable": "#FFFFFF",
      "nonSelectable": "#D9D9D9",
      "search": "#FFF2CC"
    },
    "modeBehavior": {
      "create": {
        "defaultFieldColor": "editable",
        "readOnlyFieldColor": "nonSelectable",
        "fieldStateRules": [
          { "when": "field.editable === true", "color": "editable" },
          { "when": "field.editable === false", "color": "nonSelectable" }
        ]
      },
      "search": {
        "defaultFieldColor": "search",
        "readOnlyFieldColor": "nonSelectable",
        "fieldStateRules": [
          { "when": "field.searchable === true", "color": "search" },
          { "when": "field.searchable === false", "color": "nonSelectable" }
        ],
        "filteringRule": "Any non-empty search-colored field becomes a filter condition"
      },
      "update": {
        "defaultFieldColor": "editable",
        "readOnlyFieldColor": "nonSelectable",
        "fieldStateRules": [
          { "when": "field.updatable === true", "color": "editable" },
          { "when": "field.updatable === false", "color": "nonSelectable" }
        ]
      }
    }
  },
  "structure": {
    "header": {
      "type": "DocumentHeader",
      "fields": []
    },
    "body": {
      "type": "DocumentBody",
      "tabs": [
        { "code": "content", "name": "å…§å®¹", "fields": [] },
        { "code": "logistics", "name": "ç‰©æµ", "fields": [] },
        { "code": "accounting", "name": "æœƒè¨ˆ", "fields": [] },
        { "code": "attachments", "name": "é™„ä»¶", "fields": [] }
      ]
    }
  },
  "fieldModel": {
    "commonProps": [
      "code", "label", "dataType",
      "searchable", "updatable", "editable", "selectable",
      "hasValidValues", "validValuesSource",
      "hasDefaultValue", "defaultValue",
      "defaultByQuery", "defaultQuerySpec",
      "linkedChildForm", "required",
      "isMasterLinked", "onDoubleClick"
    ],
    "dataTypes": [
      "text",
      "date",
      "objectRef",
      "checkbox",
      "list",
      "radio"
    ],
    "validValuesSourceSpec": {
      "type": "staticOrQuery",
      "static": [{ "code": "A", "name": "é¡¯ç¤ºåç¨±A" }],
      "query": {
        "source": "masterOrTx",
        "table": "OCRD",
        "keyColumn": "CardCode",
        "textColumn": "CardName",
        "filters": []
      }
    },
    "defaultQuerySpec": {
      "query": "SELECT TOP 1 Value FROM SomeTable WHERE Cond=@cond",
      "params": [{ "name": "@cond", "source": "context.userId" }]
    },
    "onDoubleClickSpec": {
      "open": "masterInfo|childForm",
      "target": "OCRD|customChildFormCode"
    }
  }
}

ç¯„ä¾‹ï¼šä»¥ã€Œæœå‹™é¡å‹æ¡è³¼å–®ã€é¢¨æ ¼çš„ B1 äº¤æ˜“å®šç¾©ï¼ˆæœ€å°å¯ç”¨ï¼‰
{
  "object": "B1Transaction",
  "meta": {
    "docType": "ServicePurchase",
    "title": "æœå‹™æ¡è³¼äº¤æ˜“"
  },
  "modes": ["create", "search", "update"],
  "ui": {
    "colors": {
      "editable": "#FFFFFF",
      "nonSelectable": "#D9D9D9",
      "search": "#FFF2CC"
    }
  },
  "structure": {
    "header": {
      "fields": [
        {
          "code": "DocNum",
          "label": "å–®è™Ÿ",
          "dataType": "text",
          "searchable": true,
          "updatable": false,
          "editable": false,
          "selectable": false,
          "hasValidValues": false,
          "hasDefaultValue": false,
          "required": false,
          "isMasterLinked": false
        },
        {
          "code": "CardCode",
          "label": "ä¾›æ‡‰å•†ä»£ç¢¼",
          "dataType": "objectRef",
          "searchable": true,
          "updatable": true,
          "editable": true,
          "selectable": true,
          "hasValidValues": true,
          "validValuesSource": {
            "type": "query",
            "query": {
              "source": "master",
              "table": "OCRD",
              "keyColumn": "CardCode",
              "textColumn": "CardName",
              "filters": [{ "column": "CardType", "op": "=", "value": "S" }]
            }
          },
          "hasDefaultValue": false,
          "required": true,
          "isMasterLinked": true,
          "onDoubleClick": { "open": "masterInfo", "target": "OCRD" }
        },
        {
          "code": "DocDate",
          "label": "æ–‡ä»¶æ—¥æœŸ",
          "dataType": "date",
          "searchable": true,
          "updatable": true,
          "editable": true,
          "selectable": true,
          "hasValidValues": false,
          "hasDefaultValue": true,
          "defaultValue": "today",
          "required": true,
          "isMasterLinked": false
        }
      ]
    },
    "body": {
      "tabs": [
        {
          "code": "content",
          "name": "å…§å®¹",
          "fields": [
            {
              "code": "ItemDesc",
              "label": "æœå‹™èªªæ˜",
              "dataType": "text",
              "searchable": true,
              "updatable": true,
              "editable": true,
              "selectable": true,
              "hasValidValues": false,
              "hasDefaultValue": false,
              "required": true,
              "isMasterLinked": false
            },
            {
              "code": "Quantity",
              "label": "æ•¸é‡",
              "dataType": "text",
              "searchable": true,
              "updatable": true,
              "editable": true,
              "selectable": true,
              "hasValidValues": false,
              "hasDefaultValue": false,
              "required": true,
              "isMasterLinked": false
            },
            {
              "code": "Price",
              "label": "å–®åƒ¹",
              "dataType": "text",
              "searchable": true,
              "updatable": true,
              "editable": true,
              "selectable": true,
              "hasValidValues": false,
              "hasDefaultValue": false,
              "required": true,
              "isMasterLinked": false
            }
          ]
        },
        {
          "code": "logistics",
          "name": "ç‰©æµ",
          "fields": [
            {
              "code": "ShipToCode",
              "label": "æ”¶è²¨åœ°",
              "dataType": "list",
              "searchable": true,
              "updatable": true,
              "editable": true,
              "selectable": true,
              "hasValidValues": true,
              "validValuesSource": {
                "type": "query",
                "query": {
                  "source": "master",
                  "table": "CRD1",
                  "keyColumn": "Address",
                  "textColumn": "Address",
                  "filters": [{ "column": "CardCode", "op": "=", "valueFromField": "CardCode" }]
                }
              },
              "hasDefaultValue": false,
              "required": false,
              "isMasterLinked": true,
              "onDoubleClick": { "open": "masterInfo", "target": "CRD1" }
            }
          ]
        },
        {
          "code": "accounting",
          "name": "æœƒè¨ˆ",
          "fields": [
            {
              "code": "TaxCode",
              "label": "ç¨…ç¢¼",
              "dataType": "list",
              "searchable": true,
              "updatable": true,
              "editable": true,
              "selectable": true,
              "hasValidValues": true,
              "validValuesSource": {
                "type": "query",
                "query": {
                  "source": "master",
                  "table": "OVTG",
                  "keyColumn": "Code",
                  "textColumn": "Name",
                  "filters": []
                }
              },
              "hasDefaultValue": true,
              "defaultByQuery": true,
              "defaultQuerySpec": {
                "query": "SELECT TOP 1 Code FROM OVTG WHERE Inactive='N' ORDER BY Code",
                "params": []
              },
              "required": true,
              "isMasterLinked": false
            }
          ]
        },
        {
          "code": "attachments",
          "name": "é™„ä»¶",
          "fields": [
            {
              "code": "Attachment",
              "label": "é™„ä»¶ä¸Šå‚³",
              "dataType": "objectRef",
              "searchable": false,
              "updatable": true,
              "editable": true,
              "selectable": true,
              "hasValidValues": false,
              "hasDefaultValue": false,
              "required": false,
              "isMasterLinked": false,
              "linkedChildForm": "AttachmentDialog"
            }
          ]
        }
      ]
    }
  }
}

éœ€è¦ä½ ç¢ºèªæˆ–ä¿®æ­£çš„åœ°æ–¹ï¼ˆè¦æ ¼çŸ›ç›¾ï¼æ˜“æ··æ·†é»ï¼‰

ã€Œä¸å¯æŒ‡å®šè‰²ã€çš„èªç¾©

ä½ åŒæ™‚å®šç¾©äº† editableï¼ˆå¯æ‰“å­—ï¼‰èˆ‡ selectableï¼ˆå¯é¸æ“‡æœ‰æ•ˆå€¼/å½ˆçª—æŒ‘é¸ï¼‰ã€‚

ã€Œä¸å¯æŒ‡å®šè‰²ã€çœ‹èµ·ä¾†æ˜¯ä¸å¯äº’å‹•ï¼ˆåŒ…å«ä¸èƒ½è¼¸å…¥ä¹Ÿä¸èƒ½æŒ‘é¸ï¼‰ã€‚æˆ‘å…ˆæŠŠå®ƒç•¶ä½œåªè®€è‰²ï¼ˆnonSelectableï¼‰ï¼Œå°æ‡‰ editable=false æˆ– selectable=false çš„æ¬„ä½ä¸Šè‰²ã€‚
ğŸ‘‰ æ˜¯å¦åŒæ„ï¼šã€Œä¸å¯æŒ‡å®šè‰² = åªè®€ä¸å¯äº’å‹•ã€ï¼Ÿè‹¥ä½ è¦å€åˆ†ã€Œå¯çœ‹ä½†ä¸å¯æ‰“å­—ã€ä»å¯æŒ‘é¸æ¸…å–®ã€çš„æƒ…å¢ƒï¼Œæˆ‘å¯ä»¥å†åŠ ä¸€ç¨®ã€Œå¯é¸ä¸å¯æ‰“å­—è‰²ã€ã€‚

æœå°‹æ¨¡å¼ä¸‹çš„æ¬„ä½è¡Œç‚º

ä½ å®šç¾©ã€Œæ–°å¢æ¨¡å¼ä¸­å¯è¼¸å…¥çš„æ¬„ä½ â†’ æœå°‹æ¨¡å¼æ™‚æ”¹ç‚ºæœå°‹è‰²ã€ã€‚æˆ‘å·²å¥—ç”¨æˆï¼šsearchable=true çš„æ¬„ä½æ‰è®Šé»ƒã€ä¸”éç©ºå€¼å³æˆç‚ºæ¢ä»¶ã€‚
ğŸ‘‰ æ˜¯å¦æœ‰æ¬„ä½å¯è¼¸å…¥ä½†ä¸å¯ç•¶æœå°‹æ¢ä»¶ï¼Ÿå¦‚æœæœ‰ï¼Œæˆ‘å€‘å°±è®“è©²æ¬„ä½ searchable=falseï¼Œæœå°‹æ¨¡å¼å°±æœƒæ˜¯ç°è‰²è€Œä¸æ˜¯é»ƒè‰²ã€‚

ã€Œç‰©ä»¶ã€è³‡æ–™å‹åˆ¥

æˆ‘å°‡å®ƒè§£è®€ç‚º objectRefï¼ˆé€£åˆ°ä¸»æª”æˆ–å­çª—é«”ï¼‰ä¸¦ç”¨ isMasterLinked=true + onDoubleClick.open="masterInfo" è¡¨ç¤ºé›™æ“Šå½ˆå‡ºä¸»æª”è©³æƒ…ï¼›è‹¥æ˜¯è¦é–‹å•Ÿå­æ˜ç´°è¡¨å–®å‰‡ç”¨ linkedChildFormã€‚
ğŸ‘‰ ç¢ºèªï¼šobjectRef çš„é›™æ“Šé è¨­è¡Œç‚ºæ˜¯ã€Œä¸»æª”è©³æƒ…ã€ï¼Œè‹¥æ¬„ä½é‚„è¦èƒ½æ‰“é–‹å­çª—é«”å°±å¦å¤–æ”¾ linkedChildFormã€‚

æœ‰æ•ˆå€¼ vs æ¸…å–®

ä½ åŒæ™‚æœ‰ã€Œæ¸…å–®ã€å‹æ¬„ä½èˆ‡ã€Œæœ‰æ•ˆå€¼ã€å±¬æ€§ã€‚æˆ‘ç›®å‰æ˜¯ï¼š

dataType="list" = ä»¥æ¸…å–®äº’å‹•ï¼ˆå›ºå®šæˆ–æŸ¥è©¢å–å¾—ï¼‰ã€‚

hasValidValues=true + validValuesSource = æœ‰æœ‰æ•ˆå€¼ä¾†æºï¼ˆå¯çµ¦ list/checkbox/radio ä½¿ç”¨ï¼‰ã€‚
ğŸ‘‰ ç¢ºèªé€™æ¨£çš„åˆ‡åˆ†ï¼ˆå‹åˆ¥æ±ºå®šäº’å‹•æ–¹å¼ï¼›æœ‰æ•ˆå€¼æ±ºå®šä¾†æºï¼‰æ˜¯å¦ç¬¦åˆä½ çš„ç›´è¦ºï¼Ÿ

é è¨­å€¼å…©ç¨®ä¾†æº

ä½ å®šç¾©äº†ã€Œ5-1 å¾æœ‰æ•ˆå€¼æ“‡ä¸€ã€ã€Œ5-2 ç”±ç³»çµ±æŸ¥è©¢ã€ã€‚æˆ‘å·²æ‹†æˆï¼š

hasDefaultValue + defaultValueï¼ˆéœæ…‹ï¼Œå¦‚ "today" æˆ–æŸå€‹ä»£ç¢¼ï¼‰ï¼›

defaultByQuery=true + defaultQuerySpecï¼ˆå‹•æ…‹æŸ¥è©¢ï¼‰ã€‚
ğŸ‘‰ è‹¥åŒæ¬„ä½åŒæ™‚å­˜åœ¨å…©è€…ï¼Œå„ªå…ˆæ¬Šè¦æ€éº¼å®šï¼Ÿæˆ‘æš«å®šï¼šdefaultByQuery å„ªå…ˆã€‚

æ›´æ–°æ¨¡å¼çš„å¯ç·¨è¼¯è¦å‰‡

ä½ å¯«ã€Œæ‰€æœ‰å¯æ›´æ–°æ¬„ä½ç‚ºå¯ç·¨è¼¯è‰²ä¸”å¯ç·¨è¼¯ã€ã€‚æˆ‘å°æ‡‰æˆ updatable=true çš„æ¬„ä½åœ¨ update æ¨¡å¼æœƒæ˜¯ç™½è‰²ã€å¯å‹•ä½œï¼›å¦å‰‡ç°è‰²ã€‚
ğŸ‘‰ è‹¥æŸæ¬„ä½åœ¨ create å¯ç·¨è¼¯ã€ä½†åœ¨ update æ‡‰å›ºå®šä¸å¯æ”¹ï¼Œè«‹åœ¨æ¬„ä½å±¤ç´šåŠ  updatable=falseã€‚

å¦‚æœä»¥ä¸Šè¦æ ¼ä½ è¦ºå¾— OKï¼Œæˆ–è¦æˆ‘åœ¨ JSON ä¸­å†åŠ å…¥æ›´å¤šæ¬„ä½å±¬æ€§ï¼ˆä¾‹å¦‚ï¼šæ ¼å¼åŒ–è¦å‰‡ã€ç²¾åº¦ã€å°æ•¸ä½ã€æœ€å°/æœ€å¤§é•·åº¦ã€è·¨æ¬„ä½é©—è­‰è¦å‰‡ã€æ¬„ä½å°æ‡‰åˆ° SAP è¡¨/æ¬„ä½çš„ mapping ï¼‰ï¼Œä½ ç›´æ¥å‘Šè¨´æˆ‘å³å¯ã€‚æˆ‘å†å¹«ä½ æŠŠ Schema æ“´å……å®Œæ•´ï¼Œç„¶å¾Œæˆ‘å€‘å°±èƒ½ç”¨é€™å¥—çµæ§‹ä¾†ã€Œå®£å‘Šã€ä½ çš„ç¬¬ä¸€å€‹æ–°åŠŸèƒ½é é¢æ¬„ä½èˆ‡è¡Œç‚ºã€‚

ç­‰ä½ å›è¦†ç¢ºèªï¼ä¿®æ­£é»å¾Œï¼Œè«‹èªªå‡ºä½ æƒ³åšçš„ç¬¬ä¸€å€‹åŠŸèƒ½ï¼Œæˆ‘æœƒæ ¹æ“šé€™ä»½ JSON è¦æ ¼ï¼Œç›´æ¥ç”¢å‡ºè©²åŠŸèƒ½çš„æ¬„ä½å®£å‘Š + æŸ¥è©¢/é¡¯ç¤º/ï¼ˆè‹¥éœ€ï¼‰å¯«å…¥çš„è…³æ‰‹æ¶ï¼Œè€Œä¸”å®Œå…¨æ²¿ç”¨ä½ ç¾æœ‰å¹³å°çš„é¢¨æ ¼èˆ‡ç¿’æ…£ã€‚

ï¼ˆ2025å¹´09æœˆ23æ—¥13æ™‚54åˆ†ï¼Œå°åŒ—ï¼‰

ä½ èªªï¼š
1.æˆ‘è¦çš„ä¸å¯é¸æ˜¯å¸Œæœ›ä½¿ç”¨è€…ç„¡æ³•å°‡Cursorç§»è‡³è©²æ¬„ä½ï¼Œè®“ä»–å€‘åœ¨æŒ‰Tabçš„æ™‚å€™ä¹Ÿæœƒè‡ªå‹•è·³éå®ƒï¼Œç¯€çœTabåˆ‡æ›çš„æ™‚é–“ï¼Œä¹Ÿé¿å…ä½¿ç”¨è€…æ„å¤–é¸åˆ°äº†è©²æ¬„ï¼Œå»ç„¡æ³•è¼¸å…¥çš„ç…©èºæƒ…æ³ã€‚
2.searchable=true çš„æ¬„ä½æ‰è®Šé»ƒ æ²’æœ‰éŒ¯ã€‚
æœ‰ï¼Œæœ‰çš„æ¬„ä½æœƒæ˜¯å¯è¼¸å…¥ï¼Œä½†ä¸å¯ç•¶æœå°‹æ¢ä»¶ã€‚
3.æ‰“é–‹ä¸»æª”æœƒæ˜¯ç›´æ¥é»è©²ä¸»æª”æ˜ç´°æ¬„ä½ï¼Œæ‰“é–‹å­æ˜ç´°è¡¨æœƒæ˜¯åœ¨æ˜ç´°åŒåˆ—çš„å…¶å®ƒæ¬„ä½æˆ–æ˜¯è¡¨é ­çš„ä¸»æª”æ¬„ä½æ—é‚Šçš„æŒ‰éˆ•ï¼Œé»æ“Šæ™‚æœƒæ ¹æ“šè¡¨é ­ä¸»æª”/å–®è™Ÿæˆ–æ˜ç´°åŒåˆ—çš„ä¸»æª”ç­‰Keyå€¼æˆ–å…¶ä»–è³‡è¨Šä¾†æ±ºå®šé–‹å•Ÿçš„å­æ˜ç´°è¡¨å…§å®¹ï¼Œä¸¦ä¸æœƒéœ€è¦ä½¿ç”¨è€…é¸æ“‡æˆ–æ˜¯æ ¹æ“šæƒ…æ³åˆ¤æ–·é›™æ“Šæ™‚çš„è¡Œç‚ºã€‚
4.æ˜¯
5.é€™é‚Šæ˜¯äº’æ–¥çš„ï¼Œæ‰¿4. æœ‰æ•ˆå€¼ä¾†æºå°±æœƒå®šç¾©æ˜¯å›ºå®šæœ‰æ•ˆå€¼ï¼Œé‚„æ˜¯å¾ç³»çµ±æŸ¥è©¢å–å¾—æœ‰æ•ˆå€¼ï¼Œæ‰€ä»¥é¸æ“‡äº†å›ºå®šå°±ä¸æœƒæ˜¯æŸ¥è©¢ï¼Œé¸æ“‡æŸ¥è©¢å°±ä¸æœƒæ˜¯å›ºå®šï¼Œè‹¥é¸æ“‡çš„æ–¹å¼ç„¡æ³•å–å¾—è³‡æ–™ï¼Œæ¸…å–®å°±æ‡‰ç‚ºç©ºç™½ï¼Œcheckboxæˆ–Radioå°±æ‡‰è©²ä¸é¡¯ç¤ºä»»ä½•é¸é …æˆ–æ–¹æ¡†ã€‚è½‰è€Œé¡¯ç¤º"è³‡æ–™å–å¾—éŒ¯èª¤ï¼Œè«‹è¯çµ¡ç³»çµ±ç®¡ç†å“¡"
6. é€™è£¡æ¯”è¼ƒç‰¹åˆ¥ï¼Œè«‹å…ˆå”åŠ©æˆ‘é‡æ¸…é€™å€‹å•é¡Œï¼š
ä¸€èˆ¬ä¾†èªªï¼Œæˆ‘æ‡‰è©²åœ¨ç‰©ä»¶ä¸Šè¨­å®šå„ç¨®æ¨¡å¼çš„å±¬æ€§ç‹€æ…‹ï¼Œ
é‚„æ˜¯èªªç‰©ä»¶åªæœ‰é è¨­çš„ç‹€æ…‹ï¼Œè€Œåœ¨åˆ‡æ›æ¨¡å¼çš„Functionè£¡é¢è¨­å®šæ¯å€‹å±¬æ€§åœ¨æ¯å€‹æ¨¡å¼æ‡‰åˆ‡æ›åˆ°å“ªå€‹ç‹€æ…‹ï¼Ÿ
ChatGPT èªªï¼š

è¶…æ¸…æ¥šï¼Œæ„Ÿè¬è£œå……ï¼æˆ‘å…ˆæŠŠä½ çš„ 1â€“5 é»å¸æ”¶é€²çµ±ä¸€çš„ JSON ç‰©ä»¶è¦æ ¼ï¼Œä¸¦å›ç­”ç¬¬ 6 é»è©²æ€éº¼è¨­è¨ˆã€Œæ¨¡å¼ç‹€æ…‹ã€çš„æœ€ä½³åšæ³•ã€‚ä»¥ä¸‹å…§å®¹åªé‡å°ç‰©ä»¶å®šç¾©èˆ‡è¡Œç‚ºè¦æ ¼ï¼Œä¸æ¶‰åŠä»»ä½•æ—¢æœ‰åŠŸèƒ½å„ªåŒ–æˆ–è£œå¼·ã€‚

ä¸€ã€æ›´æ–°å¾Œçš„ JSON è¦æ ¼ï¼ˆæ ¸å¿ƒç‰‡æ®µï¼‰

ç›®æ¨™ï¼šåŒä¸€ä»½å®£å‘Šå¯æ”¯æ´ã€Œæ–°å¢/æœå°‹/æ›´æ–°ã€ä¸‰ç¨®æ¨¡å¼ï¼›æ¬„ä½å¯ä»¥ å¯ç·¨è¼¯ï¼ˆeditableï¼‰ã€å¯æŒ‡å®šï¼ˆselectableï¼‰ã€å¯èšç„¦/å¯ Tab åœç•™ï¼ˆfocusableï¼‰ å„è‡ªç¨ç«‹ï¼›æœå°‹æ¨¡å¼åƒ… searchable=true çš„æ¬„æœƒè®Šé»ƒä¸¦ç•¶ä½œæ¢ä»¶ï¼›ã€Œä¸å¯é¸ã€= ç„¡æ³•èšç„¦ï¼‹Tab è‡ªå‹•è·³éã€‚

{
  "object": "B1Transaction",
  "version": "1.0.1",
  "modes": ["create", "search", "update"],
  "ui": {
    "theme": {
      "colorEditable": "#FFFFFF",
      "colorReadonly": "#D9D9D9",
      "colorSearch": "#FFF2CC"
    },
    "tab": {
      "autoSkipNonFocusable": true,
      "order": []  // å¯é¸ï¼šè‡ªè¨‚æ•´é«” Tab é †åºï¼ˆä»¥æ¬„ä½ code æ’åºï¼‰
    }
  },
  "structure": {
    "header": { "fields": [] },
    "body": {
      "tabs": [
        { "code": "content", "name": "å…§å®¹", "fields": [] },
        { "code": "logistics", "name": "ç‰©æµ", "fields": [] },
        { "code": "accounting", "name": "æœƒè¨ˆ", "fields": [] },
        { "code": "attachments", "name": "é™„ä»¶", "fields": [] }
      ]
    }
  },
  "fieldModel": {
    "props": {
      "code": "æ¬„ä½ä»£ç¢¼",
      "label": "æ¨™ç±¤",
      "dataType": "text|date|objectRef|checkbox|list|radio",
      "searchable": "bool",
      "updatable": "bool",
      "editable": "bool",
      "selectable": "bool",
      "focusable": "bool",
      "required": "bool",
      "isMasterLinked": "bool",
      "valueSource": {
        "type": "none|static|query",
        "static": [{ "code": "A", "name": "é¡¯ç¤ºA" }],
        "query": {
          "table": "ä¾†æºè¡¨æˆ–è¦–åœ–",
          "keyColumn": "ä»£ç¢¼æ¬„",
          "textColumn": "åç¨±æ¬„",
          "filters": []
        },
        "onError": {
          "fallback": "empty", 
          "message": "è³‡æ–™å–å¾—éŒ¯èª¤ï¼Œè«‹è¯çµ¡ç³»çµ±ç®¡ç†å“¡"
        }
      },
      "defaultValue": null,
      "defaultQuery": null,
      "actions": {
        "click": "none|openMasterInfo",
        "adjacentButtons": [
          {
            "code": "OpenChild",
            "label": "é–‹å­æ˜ç´°",
            "opens": "childForm",
            "paramsFrom": "header|row",
            "paramMap": { "DocEntry": "DocEntry", "CardCode": "CardCode" }
          }
        ]
      }
    }
  },
  "modePolicies": {
    "create": {
      "fieldDefaults": {
        "color": "editable",
        "editable": true,
        "focusable": true,
        "selectable": true
      },
      "stateRules": [
        { "when": "field.editable == false", "set": { "color": "readonly", "focusable": false } }
      ]
    },
    "search": {
      "fieldDefaults": {
        "color": "readonly",
        "editable": false,
        "focusable": false,
        "selectable": false
      },
      "stateRules": [
        { "when": "field.searchable == true", "set": { "color": "search", "focusable": true } }
      ],
      "filteringRule": "éç©ºä¸” color==search çš„æ¬„å€¼ â†’ çµ„åˆæˆæŸ¥è©¢æ¢ä»¶"
    },
    "update": {
      "fieldDefaults": {
        "color": "readonly",
        "editable": false,
        "focusable": false,
        "selectable": false
      },
      "stateRules": [
        { "when": "field.updatable == true", "set": { "color": "editable", "editable": true, "focusable": true } }
      ]
    }
  }
}

èªªæ˜ï¼ˆå°æ‡‰ä½ çš„ 1â€“5 é»ï¼‰

ä¸å¯é¸ = ä¸èƒ½èšç„¦/ä¸èƒ½åœç•™ï¼šä»¥ focusable=false è¡¨ç¤ºï¼ŒTab è‡ªå‹•è·³éï¼ˆautoSkipNonFocusable=trueï¼‰ã€‚

æœå°‹æ¨¡å¼ï¼šåªæœ‰ searchable=true çš„æ¬„è®Šé»ƒï¼ˆcolorSearchï¼‰ä¸” focusable=trueï¼Œå…¶ä»–æ¬„ç‚ºå”¯è®€ç°ã€‚

æ¬„å¯è¼¸å…¥ä½†ä¸å¯æœå°‹ï¼šå®£å‘Š editable=trueã€searchable=falseï¼›åœ¨æœå°‹æ¨¡å¼ä»æ˜¯ç°ï¼‹ä¸å¯èšç„¦ã€‚

ä¸»æª”èˆ‡å­æ˜ç´°é–‹å•Ÿæ–¹å¼ï¼š

é»æ“Šæ¬„ä½æœ¬èº« â†’ actions.click="openMasterInfo"

åŒåˆ—æˆ–è¡¨é ­æ—é‚Šçš„æŒ‰éˆ• â†’ actions.adjacentButtonsï¼ˆç”¨ paramsFrom èˆ‡ paramMap æŒ‡å®šå¸¶å…¥éµå€¼ï¼‰ã€‚

æœ‰æ•ˆå€¼ä¾†æºäº’æ–¥ï¼švalueSource.type åƒ…èƒ½ç‚º static æˆ– query å…¶ä¸€ï¼›è‹¥æŸ¥ä¸åˆ°æˆ–éŒ¯èª¤ â†’ ä¾ onError é¡¯ç¤ºè¨Šæ¯ä¸”ä¸é¡¯ç¤ºé¸é …ã€‚

äºŒã€æ¬„ä½å®šç¾©ã€Œæœ€å°å¯¦ä¾‹ã€ï¼ˆç‰‡æ®µï¼‰

å±•ç¤ºã€Œå¯è¼¸å…¥ä½†ä¸å¯æœå°‹ã€èˆ‡ã€Œæœå°‹å°ˆç”¨æ¬„ä½ã€åŒæ™‚å­˜åœ¨æ™‚çš„ç‹€æ…‹åˆ‡æ›ã€‚

{
  "structure": {
    "header": {
      "fields": [
        {
          "code": "CardCode",
          "label": "ä¸»æª”ï¼šå®¢æˆ¶ä»£ç¢¼",
          "dataType": "objectRef",
          "isMasterLinked": true,
          "editable": true,
          "updatable": true,
          "searchable": false,
          "selectable": true,
          "focusable": true,
          "actions": { "click": "openMasterInfo" },
          "valueSource": {
            "type": "query",
            "query": { "table": "OCRD", "keyColumn": "CardCode", "textColumn": "CardName", "filters": [{ "column": "CardType", "op": "=", "value": "C" }] },
            "onError": { "fallback": "empty", "message": "è³‡æ–™å–å¾—éŒ¯èª¤ï¼Œè«‹è¯çµ¡ç³»çµ±ç®¡ç†å“¡" }
          }
        },
        {
          "code": "CardNameLike",
          "label": "æœå°‹ï¼šå®¢æˆ¶åç¨±åŒ…å«",
          "dataType": "text",
          "editable": false,
          "updatable": false,
          "searchable": true,
          "selectable": false,
          "focusable": true
        }
      ]
    }
  }
}


createï¼šCardCode ç™½è‰²å¯ç·¨è¼¯å¯æŒ‘ï¼›CardNameLike ç°ï¼ˆä¸å¯ç·¨è¼¯ï¼‰ã€‚

searchï¼šCardCode å›  searchable=false â†’ ç°ï¼†ä¸å¯èšç„¦ï¼›CardNameLike é»ƒè‰²å¯èšç„¦ï¼Œè¼¸å…¥å€¼æœƒæˆç‚º Like æ¢ä»¶ã€‚

updateï¼šCardCode å›  updatable=true â†’ ç™½è‰²å¯ç·¨è¼¯ï¼›CardNameLike ç°ã€‚

ä¸‰ã€ç¬¬ 6 é»ï¼šæ¨¡å¼ç‹€æ…‹æ‡‰è©²æ€éº¼è¨­è¨ˆï¼Ÿ

ä½ å•çš„æ˜¯å®£å‘Š vs ç¨‹å¼é‚è¼¯çš„åˆ†å·¥ã€‚æˆ‘å»ºè­°æ¡ ã€Œé è¨­å±¬æ€§ + æ¨¡å¼è¦†å¯«è¡¨ã€çš„å®£å‘Šå¼æ··åˆï¼Œç†ç”±ï¼š

A. å…¨å®£å‘Šï¼ˆæ¯æ¬„ä½æŠŠä¸‰ç¨®æ¨¡å¼éƒ½å¯«æ­»ï¼‰

å„ªé»ï¼šä¸€ç›®äº†ç„¶ã€‚

ç¼ºé»ï¼šé‡è¤‡å¤šã€å®¹æ˜“ä¸ä¸€è‡´ï¼ˆç¶­è­·æˆæœ¬é«˜ï¼‰ã€‚

B. å…¨ç¨‹å¼ï¼ˆæ¬„ä½åªå¯«é è¨­ï¼Œåˆ‡æ›æ¨¡å¼æ™‚ç”¨ Function é€æ¬„è¦†å¯«ï¼‰

å„ªé»ï¼šå½ˆæ€§å¤§ã€‚

ç¼ºé»ï¼šè¦å‰‡åˆ†æ•£åœ¨ç¨‹å¼ï¼Œæ—¥å¾Œå¾ˆé›£è¿½ï¼›ä¸åŒé é¢å¯èƒ½è¡Œç‚ºæ¼‚ç§»ã€‚

C. æ··åˆï¼ˆå»ºè­°ï¼‰

åœ¨ JSON å¯«æ¬„ä½çš„åŸºç¤å±¬æ€§ï¼ˆeditable/searchable/updatable/selectable/focusableï¼‰ï¼Œ

å¦åœ¨ JSON å¯«ä¸€ä»½æ¨¡å¼è¦†å¯«è¡¨ï¼ˆmodePoliciesï¼‰ï¼Œæ˜¯é€šç”¨è¦å‰‡ï¼ˆå¦‚ï¼šsearch æ¨¡å¼è®“ searchable=true çš„æ¬„ä½ â†’ é»ƒè‰²ï¼‹å¯èšç„¦ï¼›å…¶ä»–æ¬„ç°ï¼‹ä¸å¯èšç„¦ï¼‰ã€‚

UI å¼•æ“åˆ‡æ›æ¨¡å¼æ™‚ï¼Œä¾åºå¥—ç”¨ï¼š

æ¬„ä½åŸºç¤å±¬æ€§ï¼ˆæ¯æ¬„ä½è‡ªèº«å®£å‘Šï¼‰

æ¨¡å¼é è¨­ï¼ˆfieldDefaultsï¼‰

æ¨¡å¼è¦å‰‡ï¼ˆstateRulesï¼‰
å½¢æˆæœ€çµ‚ç‹€æ…‹ï¼ˆè‰²å½©/å¯ç·¨è¼¯/å¯èšç„¦/å¯æŒ‡å®šï¼‰ã€‚

é€™æ¨£åšçš„å¥½è™•ï¼š

ä¸€è‡´æ€§ï¼šåŒæ¨¡å¼ä¸‹æ‰€æœ‰é é¢è¡Œç‚ºä¸€è‡´ï¼ˆå› ç‚º modePolicies æ˜¯å…¨åŸŸè¦å‰‡ï¼‰ã€‚

å¯è¦†å¯«ï¼šå€‹åˆ¥æ¬„ä½åªè¦æ”¹è‡ªèº«å®£å‘Šï¼Œå°±èƒ½è‡ªç„¶è½å…¥é€šç”¨è¦å‰‡ï¼ˆå¿…è¦æ™‚å†çµ¦ã€Œä¾‹å¤–ã€æ¬„ä½åŠ  modeOverrideï¼Œæˆ‘å€‘ä¹Ÿå¯é ç•™æ­¤æ“´å……ï¼‰ã€‚

å¯æ¸¬è©¦ï¼šè¦å‰‡è¡¨å¯åšå–®å…ƒæ¸¬è©¦èˆ‡å¿«ç…§æ¯”å°ã€‚

è‹¥ä½ åŒæ„ï¼Œæˆ‘å°±ä»¥ C. æ··åˆæ–¹æ¡ˆ ä½œç‚ºå¾ŒçºŒæ‰€æœ‰ B1 äº¤æ˜“é çš„å”¯ä¸€è¦ç¯„ã€‚
ä¹‹å¾Œè‹¥æœ‰å°‘æ•¸æ¬„ä½éœ€è¦åœ¨ç‰¹å®šæ¨¡å¼ç‰¹ä¾‹åŒ–ï¼Œæˆ‘æœƒåœ¨æ¬„ä½åŠ  modeOverrideï¼ˆå¯é¸ï¼‰ï¼š

"modeOverride": {
  "search": { "focusable": false }, 
  "update": { "editable": false }
}

å››ã€éœ€è¦ä½ ç¢ºèªçš„ 3 ä»¶äº‹

ã€Œä¸å¯é¸ = ç„¡æ³•èšç„¦ï¼ˆfocusable=falseï¼‰ï¼‹ Tab è·³éã€â€”é€™å®šç¾©æ˜¯å¦å®Œå…¨ç¬¦åˆä½ çš„æœŸå¾…ï¼Ÿ

ã€Œä¸»æª”ã€æ¡æ¬„ä½é»æ“Šé–‹ä¸»æª”ï¼Œã€Œå­æ˜ç´°ã€æ¡æ—é‚ŠæŒ‰éˆ•å¸¶åƒæ•¸é–‹çª—â€”æœ¬è¦æ ¼æ˜¯å¦ç„¡éœ€ã€Œé›™æ“Šã€èªç¾©ï¼Ÿ

æ¡ç”¨ æ··åˆæ–¹æ¡ˆï¼ˆé è¨­å±¬æ€§ + modePolicies è¦å‰‡ï¼‰ ä½œç‚ºå¾ŒçºŒå”¯ä¸€è¦ç¯„ï¼Œå¯ä»¥å—ï¼Ÿ

ç¢ºèªå¾Œæˆ‘å°±å¯ä»¥ç”¨é€™ä»½è¦æ ¼ï¼Œå¹«ä½ æŠŠç¬¬ä¸€å€‹åŠŸèƒ½çš„ã€Œæ¬„ä½å®£å‘Š JSONï¼‹æŸ¥è©¢/é¡¯ç¤ºï¼ˆå«æœå°‹æ¨¡å¼ï¼‰éª¨æ¶ã€ä¸€æ¬¡ç”¢å‡ºã€‚ä½ åªè¦å‘Šè¨´æˆ‘ï¼š

é€™å€‹åŠŸèƒ½çš„åç¨±ï¼ˆæ›åœ¨å“ªå€‹ç¯€é»ä¸‹ï¼‰ã€

è¦æŸ¥/å¯«çš„ SAP è¡¨æˆ– UDTï¼ˆæˆ‘å†å‘ä½ è¦å¿…è¦çš„æ¬„ä½æ¸…å–®ï¼‰ï¼Œ

ä»¥åŠæ¯å€‹é ç±¤çš„æ¬„ä½è¦å“ªäº›ï¼ˆå…ˆåˆ— 5â€“10 å€‹é—œéµæ¬„å³å¯ï¼‰ã€‚

ï¼ˆ2025å¹´09æœˆ24æ—¥10æ™‚04åˆ†ï¼Œå°åŒ—ï¼‰

ä½ èªªï¼š
1.æ˜¯
2.
æƒ³æ›´æ–°å­è¦–çª—é–‹å•Ÿçš„å®šç¾©ï¼š
2-1.é›™æ“Šä¸»æª”æ¬„ä½é–‹å•Ÿä¸»æª”è¦–çª—
    ä¾‹å¦‚é›™æ“Šé …ç›®ä»£ç¢¼é–‹å•Ÿé …ç›®ä¸»æª”è¦–çª—
2-2.é›™æ“Šå­æ˜ç´°æ¬„ä½é–‹å•Ÿå­æ˜ç´°è¦–çª—
    (é‡è¦)ï¼Œä¾‹å¦‚è²»ç”¨ç”³è«‹å–®ï¼Œä½¿ç”¨è€…æœƒéœ€è¦åœ¨ä¸€å¼µå–®çš„æ˜ç´°è¼¸å…¥å¤šå¼µæ†‘è­‰(ä¾‹å¦‚çµ±ä¸€ç™¼ç¥¨)è™Ÿç¢¼ï¼Œç•¶ä½¿ç”¨è€…é›™æ“Šç™¼ç¥¨è™Ÿç¢¼çš„æ™‚å€™ï¼Œæ‡‰å½ˆå‡ºå­æ˜ç´°è¦–çª—ï¼Œè®“ä½¿ç”¨è€…å¯ä»¥è¼¸å…¥æ­¤å¼µç™¼ç¥¨çš„æ˜ç´°ã€‚
2-3.é›™æ“Šå­å ±è¡¨æ¬„ä½é–‹å•Ÿå­å ±è¡¨
    ä¾‹å¦‚é›™æ“Šåƒ¹æ ¼æ¬„ä½æ™‚ï¼Œå½ˆå‡ºæœ€å¾Œåƒ¹æ ¼å ±è¡¨è¦–çª—ï¼Œæ ¹æ“šè¡¨é ­çš„ä¾›æ‡‰å•†ã€æ–‡ä»¶éå¸³æ—¥æœŸã€è¡¨èº«åŒåˆ—çš„é …ç›®ä»£ç¢¼ç­‰Key/ç¯©é¸æ¢ä»¶é¡¯ç¤ºç›¸é—œè³‡æ–™ã€‚

3.æ˜¯ï¼Œè«‹æ¡ç”¨æ··åˆæ–¹æ¡ˆã€‚
ChatGPT èªªï¼š
å·²æ€è€ƒ 11s

å¤ªå¥½äº†ï¼Œæˆ‘æŠŠä½ çš„æ–°è¦å‰‡ï¼ˆ2-1ï½2-3ï¼‰æ•´åˆé€²æˆ‘å€‘çš„å®£å‘Šå¼è¦æ ¼ï¼Œä¸¦æ¡ç”¨ä½ åŒæ„çš„ã€Œæ··åˆæ–¹æ¡ˆï¼šæ¬„ä½é è¨­å±¬æ€§ + å…¨åŸŸ modePolicies è¦†å¯«ã€ã€‚ä¸‹é¢æ˜¯æ›´æ–°å¾Œçš„ JSON è¦æ ¼ï¼ˆæ ¸å¿ƒï¼‰èˆ‡æœ€å°å¯¦ä¾‹ï¼Œä¾›ä½ ä¹‹å¾Œç›´æ¥æ²¿ç”¨ã€‚

B1äº¤æ˜“ ç‰©ä»¶è¦æ ¼ï¼ˆv1.1 â€” å«é›™æ“Šè¡Œç‚ºï¼‰
{
  "object": "B1Transaction",
  "version": "1.1.0",
  "modes": ["create", "search", "update"],
  "ui": {
    "theme": {
      "colorEditable": "#FFFFFF",
      "colorReadonly": "#D9D9D9",
      "colorSearch": "#FFF2CC"
    },
    "tab": {
      "autoSkipNonFocusable": true,
      "order": []
    }
  },
  "structure": {
    "header": { "type": "DocumentHeader", "fields": [] },
    "body": {
      "type": "DocumentBody",
      "tabs": [
        { "code": "content", "name": "å…§å®¹", "fields": [] },
        { "code": "logistics", "name": "ç‰©æµ", "fields": [] },
        { "code": "accounting", "name": "æœƒè¨ˆ", "fields": [] },
        { "code": "attachments", "name": "é™„ä»¶", "fields": [] }
      ]
    }
  },
  "fieldModel": {
    "props": {
      "code": "æ¬„ä½ä»£ç¢¼",
      "label": "æ¨™ç±¤",
      "dataType": "text|date|objectRef|checkbox|list|radio",
      "searchable": "bool",
      "updatable": "bool",
      "editable": "bool",
      "selectable": "bool",
      "focusable": "bool",
      "required": "bool",
      "isMasterLinked": "bool",

      "valueSource": {
        "type": "none|static|query",
        "static": [{ "code": "A", "name": "é¡¯ç¤ºA" }],
        "query": {
          "table": "ä¾†æºè¡¨æˆ–è¦–åœ–",
          "keyColumn": "ä»£ç¢¼æ¬„",
          "textColumn": "åç¨±æ¬„",
          "filters": []
        },
        "onError": {
          "fallback": "empty",
          "message": "è³‡æ–™å–å¾—éŒ¯èª¤ï¼Œè«‹è¯çµ¡ç³»çµ±ç®¡ç†å“¡"
        }
      },

      "defaultValue": null,
      "defaultQuery": null,

      "actions": {
        "doubleClick": {
          "type": "none|openMasterInfo|openChildDetailForm|openChildReport",
          "paramsFrom": "header|row",
          "paramMap": { "DocEntry": "DocEntry", "CardCode": "CardCode", "ItemCode": "ItemCode" }
        },
        "adjacentButtons": [
          {
            "code": "OpenChild",
            "label": "é–‹å­æ˜ç´°",
            "action": "openChildDetailForm",
            "paramsFrom": "row",
            "paramMap": { "DocEntry": "DocEntry", "LineNum": "LineNum" }
          }
        ]
      }
    }
  },

  "modePolicies": {
    "create": {
      "fieldDefaults": { "color": "editable", "editable": true,  "focusable": true,  "selectable": true },
      "stateRules":   [ { "when": "field.editable == false", "set": { "color": "readonly", "focusable": false } } ]
    },
    "search": {
      "fieldDefaults": { "color": "readonly", "editable": false, "focusable": false, "selectable": false },
      "stateRules":   [ { "when": "field.searchable == true", "set": { "color": "search",  "focusable": true  } } ],
      "filteringRule": "éç©ºä¸” color==search çš„æ¬„å€¼ â†’ çµ„åˆæˆæŸ¥è©¢æ¢ä»¶"
    },
    "update": {
      "fieldDefaults": { "color": "readonly", "editable": false, "focusable": false, "selectable": false },
      "stateRules":   [ { "when": "field.updatable == true", "set": { "color": "editable","editable": true, "focusable": true } } ]
    }
  }
}

é›™æ“Šè¡Œç‚ºï¼ˆä¾ä½ ç¬¬ 2 é»è£œå¼·ï¼‰

2-1 ä¸»æª”æ¬„ä½ â†’ openMasterInfoï¼ˆä¾‹ï¼šé›™æ“Š ItemCode é–‹ OITM ä¸»æª”è¦–çª—ï¼‰

2-2 å­æ˜ç´°æ¬„ä½ â†’ openChildDetailFormï¼ˆä¾‹ï¼šé›™æ“Š InvoiceNo å½ˆå‡ºã€Œç™¼ç¥¨æ˜ç´°ã€å­çª—ï¼Œå¸¶å…¥è¡¨é ­/åŒåˆ— keyï¼‰

2-3 å­å ±è¡¨æ¬„ä½ â†’ openChildReportï¼ˆä¾‹ï¼šé›™æ“Š Price å½ˆå‡ºã€Œæœ€å¾Œåƒ¹æ ¼å ±è¡¨ã€ï¼Œå¸¶å…¥ä¾›æ‡‰å•†ã€éå¸³æ—¥ã€é …ç›®ä»£ç¢¼ï¼‰

åƒæ•¸æ³¨å…¥çµ±ä¸€ç”¨ï¼š

paramsFrom: "header" æˆ– "row"ï¼ˆå¾è¡¨é ­æˆ–è©²åˆ—å– keyï¼‰

paramMap: { "ReportVendor": "CardCode", "ReportDate": "DocDate", "ReportItem": "ItemCode" }

æœ€å°å¯¦ä¾‹ï¼ˆç‰‡æ®µï¼‰
{
  "structure": {
    "header": {
      "fields": [
        {
          "code": "CardCode",
          "label": "ä¾›æ‡‰å•†ä»£ç¢¼",
          "dataType": "objectRef",
          "isMasterLinked": true,
          "editable": true,
          "updatable": true,
          "searchable": false,
          "selectable": true,
          "focusable": true,
          "actions": {
            "doubleClick": {
              "type": "openMasterInfo",
              "paramsFrom": "header",
              "paramMap": { "CardCode": "CardCode" }
            }
          },
          "valueSource": {
            "type": "query",
            "query": { "table": "OCRD", "keyColumn": "CardCode", "textColumn": "CardName",
              "filters": [{ "column": "CardType", "op": "=", "value": "S" }]
            },
            "onError": { "fallback": "empty", "message": "è³‡æ–™å–å¾—éŒ¯èª¤ï¼Œè«‹è¯çµ¡ç³»çµ±ç®¡ç†å“¡" }
          },
          "required": true
        },
        {
          "code": "DocDate",
          "label": "éå¸³æ—¥æœŸ",
          "dataType": "date",
          "editable": true,
          "updatable": true,
          "searchable": true,
          "selectable": true,
          "focusable": true,
          "defaultValue": "today",
          "required": true
        }
      ]
    },
    "body": {
      "tabs": [
        {
          "code": "content",
          "name": "å…§å®¹",
          "fields": [
            {
              "code": "ItemCode",
              "label": "é …ç›®ä»£ç¢¼",
              "dataType": "objectRef",
              "isMasterLinked": true,
              "editable": true,
              "updatable": true,
              "searchable": true,
              "selectable": true,
              "focusable": true,
              "actions": {
                "doubleClick": {
                  "type": "openMasterInfo",
                  "paramsFrom": "row",
                  "paramMap": { "ItemCode": "ItemCode" }
                }
              }
            },
            {
              "code": "InvoiceNo",
              "label": "ç™¼ç¥¨è™Ÿç¢¼",
              "dataType": "text",
              "editable": true,
              "updatable": true,
              "searchable": true,
              "selectable": true,
              "focusable": true,
              "actions": {
                "doubleClick": {
                  "type": "openChildDetailForm",
                  "paramsFrom": "row",
                  "paramMap": { "DocEntry": "DocEntry", "LineNum": "LineNum", "InvoiceNo": "InvoiceNo" }
                }
              }
            },
            {
              "code": "Price",
              "label": "å–®åƒ¹",
              "dataType": "text",
              "editable": true,
              "updatable": true,
              "searchable": true,
              "selectable": true,
              "focusable": true,
              "actions": {
                "doubleClick": {
                  "type": "openChildReport",
                  "paramsFrom": "row",
                  "paramMap": { "Vendor": "CardCode", "PostDate": "DocDate", "Item": "ItemCode" }
                }
              }
            }
          ]
        }
      ]
    }
  }
}

å°çµèˆ‡ä¸‹ä¸€æ­¥

ã€Œä¸å¯é¸ã€ç¾å·²ç­‰åŒ ä¸å¯èšç„¦ï¼ˆfocusable=falseï¼‰ï¼ŒTab æœƒè‡ªå‹•è·³éï¼Œå®Œå…¨ç¬¦åˆä½ çš„ 1ã€‚

ã€Œé›™æ“Šã€å·²ç´°åˆ†ç‚º ä¸»æª”ï¼å­æ˜ç´°ï¼å­å ±è¡¨ ä¸‰å‹ï¼Œé  doubleClick.type èˆ‡ paramsFrom + paramMap æ§åˆ¶ã€‚

æ¡ç”¨ æ··åˆæ–¹æ¡ˆï¼ˆä½ åŒæ„çš„ 3ï¼‰ï¼Œå¾ŒçºŒæ‰€æœ‰é é¢éƒ½èƒ½é  modePolicies ä¿æŒä¸€è‡´è¡Œç‚ºï¼›å°‘æ•¸æ¬„ä½å¦‚éœ€ç‰¹ä¾‹ï¼Œå†ç”¨ modeOverride æ“´å……å³å¯ï¼ˆæˆ‘ä¿ç•™æ­¤æ¬„ä½ï¼Œç­‰ä½ æœ‰éœ€æ±‚å†åŠ é€² schemaï¼‰ã€‚

åªè¦ä½ å‘Šè¨´æˆ‘ç¬¬ä¸€å€‹åŠŸèƒ½çš„ç›®æ¨™ï¼ˆæ›åœ¨å“ªå€‹ç¯€é»ã€è¦æŸ¥/å¯«å“ªäº› SAP è¡¨æˆ– UDTã€æ¯å€‹é ç±¤çš„é—œéµæ¬„ä½ 5â€“10 æ¬„ï¼‰ï¼Œæˆ‘å°±ç”¨é€™ä»½è¦æ ¼ï¼Œç›´æ¥å¹«ä½ ç”¢å‡ºï¼š

è©²é çš„ æ¬„ä½å®£å‘Š JSONï¼ˆå«ä¸‰ç¨®æ¨¡å¼åˆ‡æ›è¡Œç‚ºï¼‰

æŸ¥è©¢ï¼ˆCTE + åƒæ•¸åŒ–ï¼ŒSQL 2005 ç›¸å®¹ï¼‰ èˆ‡é¡¯ç¤ºç¶å®šéª¨æ¶

ï¼ˆè‹¥éœ€è¦å¯«å…¥ï¼‰DI API å¯«å…¥é››å½¢ èˆ‡æ¬„/åˆ—å°æ‡‰

ç­‰ä½ ä¸‹æŒ‡ä»¤ï¼šç¬¬ä¸€å€‹åŠŸèƒ½è¦åšå“ªä¸€é ï¼

ï¼ˆ2025å¹´09æœˆ24æ—¥10æ™‚25åˆ†ï¼Œå°åŒ—ï¼‰

ä½ èªªï¼š
æˆ‘æƒ³å…ˆæ›´æ–°ç‰©ä»¶æ ¼å¼è£¡çš„æ¬„ä½å®šç¾©ï¼ŒæŠŠæ¬„ä½ä¸­çš„7.æœ‰é€£çµå­æ˜ç´°è¡¨å–®/ç„¡é€£çµå­æ˜ç´°è¡¨å–®(é›™æ“Šæ¬„ä½å½ˆå‡ºå­æ˜ç´°è¡¨å–®çš„è¦–çª—)æ›´æ–°ç‚ºï¼š
					7.é›™æ“Šè¡Œç‚ºï¼š
						7-1.é–‹å•Ÿä¸»æª”
						7-2.é–‹å•Ÿå­æ˜ç´°è¡¨å–®
						7-3.é–‹å•Ÿå ±è¡¨
ChatGPT èªªï¼š
å·²åœæ­¢æ€è€ƒ
ä½ èªªï¼š
æˆ‘æƒ³å…ˆæ›´æ–°ç‰©ä»¶æ ¼å¼è£¡çš„æ¬„ä½å®šç¾©ï¼ŒæŠŠæ¬„ä½ä¸­çš„7.æœ‰é€£çµå­æ˜ç´°è¡¨å–®/ç„¡é€£çµå­æ˜ç´°è¡¨å–®(é›™æ“Šæ¬„ä½å½ˆå‡ºå­æ˜ç´°è¡¨å–®çš„è¦–çª—)æ›´æ–°ç‚ºï¼š
					7.é›™æ“Šè¡Œç‚ºï¼š
                        7-1.ç„¡
						7-2.é–‹å•Ÿä¸»æª”
						7-3.é–‹å•Ÿå­æ˜ç´°è¡¨å–®
						7-4.é–‹å•Ÿå ±è¡¨
ChatGPT èªªï¼š

äº†è§£ âœ…
æˆ‘å·²æŠŠã€Œæ¬„ä½å®šç¾©ã€ä¸­çš„ç¬¬ 7 é»æ›´æ–°ç‚ºã€Œé›™æ“Šè¡Œç‚ºã€ï¼Œæ˜ç¢ºæ‹†åˆ†ç‚º 4 ç¨®ç‹€æ…‹ï¼š

æ›´æ–°å¾Œæ¬„ä½å±¬æ€§ï¼ˆç‰‡æ®µï¼‰
{
  "fieldModel": {
    "props": {
      "code": "æ¬„ä½ä»£ç¢¼",
      "label": "æ¨™ç±¤",
      "dataType": "text|date|objectRef|checkbox|list|radio",
      "searchable": "bool",
      "updatable": "bool",
      "editable": "bool",
      "selectable": "bool",
      "focusable": "bool",
      "required": "bool",
      "isMasterLinked": "bool",

      "valueSource": { /* åŒå‰ */ },

      "defaultValue": null,
      "defaultQuery": null,

      "actions": {
        "doubleClick": {
          "type": "none|openMasterInfo|openChildDetailForm|openChildReport",
          "paramsFrom": "header|row",
          "paramMap": {
            "DocEntry": "DocEntry",
            "LineNum": "LineNum",
            "ItemCode": "ItemCode",
            "CardCode": "CardCode"
          }
        }
      }
    }
  }
}

å››ç¨®é›™æ“Šè¡Œç‚º

none â†’ ç„¡å‹•ä½œï¼ˆç´”é¡¯ç¤ºæ¬„ä½ï¼Œä¸è§¸ç™¼ä»»ä½•è¦–çª—ï¼‰

openMasterInfo â†’ é–‹å•Ÿä¸»æª”ï¼ˆä¾‹å¦‚é›™æ“Šé …ç›®ä»£ç¢¼ â†’ æ‰“é–‹ OITM ä¸»æª”ï¼‰

openChildDetailForm â†’ é–‹å•Ÿå­æ˜ç´°è¡¨å–®ï¼ˆä¾‹å¦‚é›™æ“Šç™¼ç¥¨è™Ÿç¢¼ â†’ æ‰“é–‹ã€Œç™¼ç¥¨æ˜ç´°ã€å­çª—ï¼‰

openChildReport â†’ é–‹å•Ÿå­å ±è¡¨ï¼ˆä¾‹å¦‚é›™æ“Šåƒ¹æ ¼ â†’ æ‰“é–‹ã€Œæœ€å¾Œåƒ¹æ ¼å ±è¡¨ã€ï¼Œå¸¶ä¾›æ‡‰å•†/æ—¥æœŸ/é …ç›®æ¢ä»¶ï¼‰

è£œå……å»ºè­°

æˆ‘ä¿ç•™ paramsFromï¼ˆä¾†æºï¼šheader æˆ– rowï¼‰èˆ‡ paramMapï¼ˆå¯¦éš›å¸¶å…¥çš„éµå€¼å°ï¼‰ï¼Œé€™æ¨£å°±èƒ½è®“åŒä¸€è¦æ ¼åŒæ™‚æ”¯æ´ã€Œè¡¨é ­ä¸»æª”ã€èˆ‡ã€Œè¡¨èº«åŒåˆ—ã€çš„é›™æ“Šæƒ…å¢ƒã€‚

å¦‚æœä½ è¦ºå¾— ã€Œå­å ±è¡¨ã€è·Ÿã€Œå­æ˜ç´°ã€å·®åˆ¥å¤§ï¼Œæˆ‘å€‘ä¹Ÿèƒ½åœ¨ JSON ä¸­å†ç´°åˆ† subFormType: "detail"|"report"ï¼Œä½†ç›®å‰ç”¨ doubleClick.type å°±èƒ½æ˜ç¢ºå€åˆ†ã€‚

è¦ä¸è¦æˆ‘å¹«ä½ æ•´ç†ä¸€å€‹å®Œæ•´æ›´æ–°å¾Œçš„æ¬„ä½å±¬æ€§å°ç…§è¡¨ï¼ˆåŒ…å« 1â€“8 é»ï¼Œæ¯å€‹å±¬æ€§æ€éº¼ç”¨ã€åœ¨ create/search/update æ¨¡å¼æœƒæ€éº¼è®ŠåŒ–ï¼‰ï¼Œè®“ä¹‹å¾Œè¨­è¨ˆåŠŸèƒ½é æ™‚ç›´æ¥æœ‰ä¸€ä»½ã€Œæ¬„ä½è¦æ ¼æª”ã€å¯ä»¥è¤‡è£½ï¼Ÿ

ä½ èªªï¼š
OK
ChatGPT èªªï¼š
å·²æ€è€ƒ 12s

å¤ªå¥½äº†ï¼ä»¥ä¸‹æ˜¯å®Œæ•´æ›´æ–°å¾Œçš„ã€Œæ¬„ä½å±¬æ€§å°ç…§è¡¨ã€ï¼Œå·²ç´å…¥ä½ å‰›å‰›ç¢ºèªçš„è¦å‰‡ï¼ˆä¸å¯é¸ï¼ä¸å¯èšç„¦ä¸” Tab è‡ªå‹•è·³éã€é›™æ“Šè¡Œç‚ºå››ç¨®ã€æ··åˆæ¨¡å¼å¥—ç”¨ï¼‰ã€‚

B1 äº¤æ˜“â€”æ¬„ä½å±¬æ€§å°ç…§è¡¨ï¼ˆv1.1ï¼‰
1) æ¬„ä½å…±åŒå±¬æ€§ï¼ˆField Propsï¼‰

codeï¼šå­—ä¸²ï¼›æ¬„ä½ä»£ç¢¼ï¼ˆå”¯ä¸€ï¼‰ã€‚

labelï¼šå­—ä¸²ï¼›é¡¯ç¤ºåç¨±ã€‚

dataTypeï¼štext | date | objectRef | checkbox | list | radioã€‚

searchableï¼šå¸ƒæ—ï¼›æ˜¯å¦å¯ä½œç‚ºæœå°‹æ¢ä»¶ï¼ˆåƒ…å½±éŸ¿ Search æ¨¡å¼ï¼‰ã€‚

updatableï¼šå¸ƒæ—ï¼›Update æ¨¡å¼æ˜¯å¦å…è¨±ä¿®æ”¹ã€‚

editableï¼šå¸ƒæ—ï¼›Create æ¨¡å¼æ˜¯å¦å¯è¼¸å…¥ï¼ˆåŸºæº–å±¬æ€§ï¼‰ã€‚

selectableï¼šå¸ƒæ—ï¼›æ˜¯å¦å¯ç”¨ã€Œé¸å–/æŒ‘é¸ã€çš„æ–¹å¼æŒ‡å®šï¼ˆä¾‹å¦‚æ¸…å–®æˆ–æŒ‘ä¸»æª”ï¼‰ã€‚

focusableï¼šå¸ƒæ—ï¼›æ˜¯å¦å¯èšç„¦ã€æ˜¯å¦å¯åœç•™åœ¨ Tab æµç¨‹ä¸­ã€‚false = Tab è‡ªå‹•è·³éã€‚

requiredï¼šå¸ƒæ—ï¼›æ˜¯å¦å¿…å¡«ï¼ˆä¸åŒæ¨¡å¼å¯åˆä½µé©—è­‰è¦å‰‡ï¼‰ã€‚

isMasterLinkedï¼šå¸ƒæ—ï¼›æ­¤æ¬„æ˜¯å¦é€£çµåˆ°ä¸»æª”è³‡æ–™ï¼ˆç”¨æ–¼ä¸»æª”è³‡è¨Šå½ˆçª—é¡¯ç¤ºï¼‰ã€‚

valueSourceï¼šæœ‰æ•ˆå€¼ä¾†æºï¼ˆäº’æ–¥ï¼‰

type: none | static | queryï¼ˆä¸‰é¸ä¸€ï¼‰

static: [{ code, name }] å›ºå®šæœ‰æ•ˆå€¼æ¸…å–®

query: { table, keyColumn, textColumn, filters: [] } ç³»çµ±æŸ¥è©¢å–å¾—æœ‰æ•ˆå€¼

onError: { fallback: "empty", message: "è³‡æ–™å–å¾—éŒ¯èª¤ï¼Œè«‹è¯çµ¡ç³»çµ±ç®¡ç†å“¡" }

defaultValueï¼šéœæ…‹é è¨­å€¼ï¼ˆä¾‹å¦‚ "today"ã€"N"ï¼‰ã€‚

defaultQueryï¼šå‹•æ…‹é è¨­å€¼ï¼ˆä¾‹å¦‚ { query, params }ï¼‰ã€‚

actions.doubleClickï¼šé›™æ“Šè¡Œç‚ºï¼ˆå››é¸ä¸€ï¼‰

type: none | openMasterInfo | openChildDetailForm | openChildReport

paramsFrom: header | rowï¼ˆå¸¶å…¥åƒæ•¸ä¾†æºï¼‰

paramMap: {"DocEntry":"DocEntry","LineNum":"LineNum","ItemCode":"ItemCode","CardCode":"CardCode"}ï¼ˆéµå€¼å°ï¼‰

actions.adjacentButtonsï¼šï¼ˆå¯é¸ï¼‰æ¬„æ—æŒ‰éˆ•é™£åˆ—ï¼Œå¦‚éœ€æä¾›ã€Œé¡¯ç¤ºå­æ˜ç´°/å­å ±è¡¨ã€æŒ‰éˆ•æ™‚ä½¿ç”¨ã€‚

å‚™è¨»

valueSource.type å¿…ç‚ºäº’æ–¥ï¼šé¸ static å°±ä¸æœƒæ˜¯ queryï¼›é¸ query å°±ä¸æœƒæ˜¯ staticã€‚æŸ¥ä¸åˆ°æˆ–éŒ¯èª¤ â†’ ä¾ onError é¡¯ç¤ºè¨Šæ¯ä¸”æ¸…å–®ç©ºç™½/ä¸é¡¯ç¤ºé¸é …ã€‚

focusable=false â‡’ ä¸å¯èšç„¦ã€Tab ç›´æ¥ç•¥éï¼›ç¬¦åˆä½ ã€Œä¸å¯é¸ã€å®šç¾©ã€‚

2) æ¨¡å¼ï¼ˆModeï¼‰èˆ‡ç‹€æ…‹å¥—ç”¨ï¼ˆæ··åˆæ–¹æ¡ˆï¼‰

ç³»çµ±åˆ‡æ›æ¨¡å¼æ™‚ï¼Œæœ€çµ‚ç‹€æ…‹ç”±ä¸‰å±¤è¦å‰‡æ±ºå®šï¼ˆä¾åºè¦†å¯«ï¼‰ï¼š

æ¬„ä½åŸºç¤å±¬æ€§ï¼ˆeditable/searchable/updatable/selectable/focusableï¼‰

modePolicies.fieldDefaultsï¼ˆè©²æ¨¡å¼é è¨­ï¼‰

modePolicies.stateRulesï¼ˆæ¢ä»¶è¦†å¯«ï¼‰

è‰²å½©ä¸»é¡Œï¼ˆå¯å…¨åŸŸæ”¹ï¼‰

colorEditableï¼š#FFFFFFï¼ˆå¯ç·¨è¼¯è‰²ï¼‰

colorReadonlyï¼š#D9D9D9ï¼ˆä¸å¯æŒ‡å®šè‰²/åªè®€ï¼‰

colorSearchï¼š#FFF2CCï¼ˆæœå°‹è‰²ï¼‰

Create æ¨¡å¼

é è¨­ï¼šcolor=editable, editable=true, focusable=true, selectable=true

è¦å‰‡ï¼šif field.editable == false â†’ color=readonly, focusable=false

å…¸å‹æ•ˆæœï¼šå¯è¼¸å…¥æ¬„ï¼ç™½è‰²ï¼›ä¸å¯è¼¸å…¥æ¬„ï¼ç°è‰²ä¸” Tab è·³é

Search æ¨¡å¼

é è¨­ï¼šcolor=readonly, editable=false, focusable=false, selectable=false

è¦å‰‡ï¼šif field.searchable == true â†’ color=search, focusable=true

å…¸å‹æ•ˆæœï¼šåªæœ‰ searchable=true çš„æ¬„è®Šé»ƒä¸”å¯èšç„¦ï¼Œéç©ºå€¼æœƒæˆç‚ºæŸ¥è©¢æ¢ä»¶ï¼›å…¶ä»–æ¬„ç°è‰²ä¸” Tab è·³é

Update æ¨¡å¼

é è¨­ï¼šcolor=readonly, editable=false, focusable=false, selectable=false

è¦å‰‡ï¼šif field.updatable == true â†’ color=editable, editable=true, focusable=true

å…¸å‹æ•ˆæœï¼šå¯æ›´æ–°æ¬„ï¼ç™½è‰²å¯ç·¨è¼¯ï¼›ä¸å¯æ›´æ–°æ¬„ï¼ç°è‰²ä¸” Tab è·³é

å¯é¸ï¼šè‹¥å°‘æ•¸æ¬„åœ¨ç‰¹å®šæ¨¡å¼è¦ç‰¹ä¾‹ï¼Œå¯åœ¨æ¬„ä½åŠ  modeOverrideï¼ˆæ—¥å¾Œéœ€è¦å†åŠ å…¥åˆ° schemaï¼‰ã€‚

3) Tab è¡Œç‚º

å…¨åŸŸè¨­å®šï¼šautoSkipNonFocusable=true â†’ æ‰€æœ‰ focusable=false çš„æ¬„ä½ï¼ŒTab è‡ªå‹•ç•¥éã€‚

å¯é¸ï¼šui.tab.order ä»¥æ¬„ä½ code é™£åˆ—æŒ‡å®š Tab é †åºï¼ˆæœªåˆ—è€…æŒ‰é è¨­é †åºæ¥çºŒï¼‰ã€‚

4) é›™æ“Šè¡Œç‚ºâ€”å®šç¾©

noneï¼šç„¡å‹•ä½œã€‚

openMasterInfoï¼šé–‹å•Ÿä¸»æª”ï¼ˆä¾‹ï¼šé›™æ“Š ItemCode â†’ OITM ä¸»æª”è¦–çª—ï¼‰ã€‚

openChildDetailFormï¼šé–‹å•Ÿå­æ˜ç´°è¡¨å–®ï¼ˆä¾‹ï¼šé›™æ“Š InvoiceNo â†’ ã€Œç™¼ç¥¨æ˜ç´°ã€å­çª—ï¼Œå¯è¼¸å…¥åŒå¼µæ†‘è­‰å¤šç­†ç´°é …ï¼‰ã€‚

openChildReportï¼šé–‹å•Ÿå­å ±è¡¨ï¼ˆä¾‹ï¼šé›™æ“Š Price â†’ ã€Œæœ€å¾Œåƒ¹æ ¼ã€å ±è¡¨ï¼›å¸¶å…¥ CardCode/DocDate/ItemCodeï¼‰ã€‚

5) æœ€å°æ¨£æ¿ï¼ˆå…©å€‹æ¬„ä½ç¤ºä¾‹ï¼‰
{
  "fields": [
    {
      "code": "CardCode",
      "label": "ä¾›æ‡‰å•†ä»£ç¢¼",
      "dataType": "objectRef",
      "isMasterLinked": true,
      "editable": true,
      "updatable": true,
      "searchable": false,
      "selectable": true,
      "focusable": true,
      "actions": {
        "doubleClick": {
          "type": "openMasterInfo",
          "paramsFrom": "header",
          "paramMap": { "CardCode": "CardCode" }
        }
      },
      "valueSource": {
        "type": "query",
        "query": {
          "table": "OCRD",
          "keyColumn": "CardCode",
          "textColumn": "CardName",
          "filters": [{ "column": "CardType", "op": "=", "value": "S" }]
        },
        "onError": { "fallback": "empty", "message": "è³‡æ–™å–å¾—éŒ¯èª¤ï¼Œè«‹è¯çµ¡ç³»çµ±ç®¡ç†å“¡" }
      },
      "required": true
    },
    {
      "code": "Price",
      "label": "å–®åƒ¹",
      "dataType": "text",
      "editable": true,
      "updatable": true,
      "searchable": true,
      "selectable": true,
      "focusable": true,
      "actions": {
        "doubleClick": {
          "type": "openChildReport",
          "paramsFrom": "row",
          "paramMap": { "Vendor": "CardCode", "PostDate": "DocDate", "Item": "ItemCode" }
        }
      }
    }
  ]
}


å¦‚æœé€™ç‰ˆå°ç…§è¡¨ OKï¼Œæˆ‘å°±ç”¨å®ƒç•¶ä½œå¾ŒçºŒæ‰€æœ‰é é¢çš„å–®ä¸€çœŸç›¸ä¾†æºï¼ˆSingle Source of Truthï¼‰ã€‚
ä½ ç¾åœ¨å¯ä»¥å‘Šè¨´æˆ‘ï¼šç¬¬ä¸€å€‹åŠŸèƒ½é è¦æ›åœ¨å“ªå€‹ç¯€é»ã€ç”¨åˆ°å“ªäº›è¡¨ï¼ˆæ¨™æº–è¡¨/UDTï¼‰èˆ‡æ¯å€‹é ç±¤çš„é—œéµæ¬„ä½ï¼ˆå…ˆåˆ— 5â€“10 æ¬„å³å¯ï¼‰ã€‚æˆ‘æœƒç›´æ¥ç”¨é€™ä»½è¦æ ¼å¹«ä½ ç”¢ç”Ÿè©²é çš„ æ¬„ä½å®£å‘Š JSON + æŸ¥è©¢/é¡¯ç¤ºéª¨æ¶ï¼ˆSQL 2005 ç›¸å®¹ï¼ŒCTEï¼‹åƒæ•¸åŒ–ï¼‰ï¼Œå¿…è¦æ™‚å†é™„ DI API å¯«å…¥é››å½¢ã€‚